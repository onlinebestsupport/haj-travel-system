<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Haj Journey - Traveler Portal</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: #f5f7fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .traveler-nav {
            background: linear-gradient(135deg, #27ae60 0%, #2c3e50 100%);
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            float: right;
        }
        
        .welcome-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .batch-card {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .info-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .status-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: bold;
        }
        
        .status-confirmed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .payment-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .payment-table th {
            background: #2c3e50;
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        .payment-table td {
            padding: 15px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .payment-paid {
            color: #27ae60;
            font-weight: bold;
        }
        
        .payment-pending {
            color: #e74c3c;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="traveler-nav">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1 style="color: white; margin: 0;"><i class="fas fa-kaaba"></i> My Haj Journey</h1>
                    <p style="color: rgba(255,255,255,0.9); margin: 5px 0 0;">Welcome, <span id="travelerName">Loading...</span></p>
                </div>
                <button onclick="logout()" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </div>

    <main class="container">
        <!-- Loading Indicator -->
        <div id="loading" style="text-align: center; padding: 50px;">
            <i class="fas fa-spinner fa-spin" style="font-size: 40px; color: #3498db;"></i>
            <p style="margin-top: 20px;">Loading your Haj journey details...</p>
        </div>

        <!-- Traveler Dashboard Content (Hidden by default) -->
        <div id="dashboardContent" style="display: none;">
            <!-- Batch Information -->
            <div class="batch-card" id="batchInfo">
                <h2 style="color: white; margin-bottom: 15px;"><i class="fas fa-layer-group"></i> Your Batch Details</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div>
                        <p style="opacity: 0.9; margin-bottom: 5px;">Batch Name</p>
                        <h3 style="color: white; margin: 0;" id="batchName">-</h3>
                    </div>
                    <div>
                        <p style="opacity: 0.9; margin-bottom: 5px;">Departure Date</p>
                        <h3 style="color: white; margin: 0;" id="departureDate">-</h3>
                    </div>
                    <div>
                        <p style="opacity: 0.9; margin-bottom: 5px;">Return Date</p>
                        <h3 style="color: white; margin: 0;" id="returnDate">-</h3>
                    </div>
                    <div>
                        <p style="opacity: 0.9; margin-bottom: 5px;">Status</p>
                        <h3 style="color: white; margin: 0;" id="batchStatus">-</h3>
                    </div>
                </div>
            </div>

            <!-- Personal Information -->
            <div class="welcome-card">
                <h2 style="color: #2c3e50; margin-bottom: 20px;"><i class="fas fa-user"></i> Your Personal Information</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div>
                        <p style="color: #7f8c8d; margin-bottom: 5px;">Full Name</p>
                        <p style="font-size: 18px; font-weight: bold;" id="fullName">-</p>
                    </div>
                    <div>
                        <p style="color: #7f8c8d; margin-bottom: 5px;">Passport Number</p>
                        <p style="font-size: 18px; font-weight: bold;" id="passportNo">-</p>
                    </div>
                    <div>
                        <p style="color: #7f8c8d; margin-bottom: 5px;">Mobile</p>
                        <p style="font-size: 18px;" id="mobile">-</p>
                    </div>
                    <div>
                        <p style="color: #7f8c8d; margin-bottom: 5px;">Email</p>
                        <p style="font-size: 18px;" id="email">-</p>
                    </div>
                    <div>
                        <p style="color: #7f8c8d; margin-bottom: 5px;">Vaccine Status</p>
                        <p><span class="status-badge status-confirmed" id="vaccineStatus">-</span></p>
                    </div>
                    <div>
                        <p style="color: #7f8c8d; margin-bottom: 5px;">Wheelchair Required</p>
                        <p id="wheelchair">-</p>
                    </div>
                </div>
            </div>

            <!-- Payment Schedule -->
            <div class="info-card">
                <h2 style="color: #2c3e50; margin-bottom: 20px;"><i class="fas fa-credit-card"></i> Payment Schedule</h2>
                <table class="payment-table">
                    <thead>
                        <tr>
                            <th>Installment</th>
                            <th>Due Date</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Payment Date</th>
                        </tr>
                    </thead>
                    <tbody id="paymentTableBody">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 30px;">
                                <i class="fas fa-info-circle"></i> Payment schedule will be updated by admin
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Important Documents -->
            <div class="info-grid">
                <div class="info-card">
                    <h3><i class="fas fa-passport"></i> Passport</h3>
                    <p id="passportStatus">Status: <span class="status-badge status-confirmed">Submitted</span></p>
                </div>
                <div class="info-card">
                    <h3><i class="fas fa-id-card"></i> Aadhaar</h3>
                    <p id="aadhaarStatus">Status: <span class="status-badge status-confirmed">Verified</span></p>
                </div>
                <div class="info-card">
                    <h3><i class="fas fa-file-invoice"></i> PAN</h3>
                    <p id="panStatus">Status: <span class="status-badge status-confirmed">Verified</span></p>
                </div>
                <div class="info-card">
                    <h3><i class="fas fa-syringe"></i> Vaccine</h3>
                    <p id="vaccineCertStatus">Status: <span class="status-badge status-confirmed">Uploaded</span></p>
                </div>
            </div>

            <!-- Emergency Contact -->
            <div class="info-card">
                <h2 style="color: #2c3e50; margin-bottom: 20px;"><i class="fas fa-phone-alt"></i> Emergency Contact</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div>
                        <p style="color: #7f8c8d;">Father's Name</p>
                        <p style="font-weight: bold;" id="fatherName">-</p>
                    </div>
                    <div>
                        <p style="color: #7f8c8d;">Mother's Name</p>
                        <p style="font-weight: bold;" id="motherName">-</p>
                    </div>
                    <div>
                        <p style="color: #7f8c8d;">Spouse's Name</p>
                        <p style="font-weight: bold;" id="spouseName">-</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Check if traveler is logged in
        const travelerId = sessionStorage.getItem('travelerId');
        const travelerPassport = sessionStorage.getItem('travelerPassport');

        if (!travelerId || !travelerPassport) {
            window.location.href = '/traveler-login';
        }

        // Logout function
        function logout() {
            sessionStorage.removeItem('travelerId');
            sessionStorage.removeItem('travelerPassport');
            window.location.href = '/traveler-login';
        }

        // Load traveler data
        async function loadTravelerData() {
            try {
                const response = await fetch(`/api/traveler/${travelerPassport}`);
                const data = await response.json();
                
                if (data.success) {
                    const t = data.traveler;
                    
                    // Hide loading, show dashboard
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('dashboardContent').style.display = 'block';
                    
                    // Update personal info
                    document.getElementById('travelerName').textContent = `${t.first_name} ${t.last_name}`;
                    document.getElementById('fullName').textContent = `${t.first_name} ${t.last_name}`;
                    document.getElementById('passportNo').textContent = t.passport_no;
                    document.getElementById('mobile').textContent = t.mobile;
                    document.getElementById('email').textContent = t.email || '-';
                    document.getElementById('vaccineStatus').textContent = t.vaccine_status || 'Not Vaccinated';
                    document.getElementById('wheelchair').textContent = t.wheelchair || 'No';
                    
                    // Update batch info
                    document.getElementById('batchName').textContent = t.batch_name || 'Not Assigned';
                    document.getElementById('departureDate').textContent = t.departure_date || 'TBD';
                    document.getElementById('returnDate').textContent = t.return_date || 'TBD';
                    document.getElementById('batchStatus').textContent = t.batch_status || 'Open';
                    
                    // Update family info
                    document.getElementById('fatherName').textContent = t.father_name || '-';
                    document.getElementById('motherName').textContent = t.mother_name || '-';
                    document.getElementById('spouseName').textContent = t.spouse_name || '-';
                    
                    // Load payment schedule
                    loadPaymentSchedule(t.id);
                }
            } catch (error) {
                console.error('Error loading traveler data:', error);
                alert('Error loading your data. Please try again.');
            }
        }

        // Load payment schedule
        async function loadPaymentSchedule(travelerId) {
    try {
        const response = await fetch(`/api/payments/traveler/${travelerId}`);
        // ... rest of code
    }
}
                const data = await response.json();
                
                if (data.success && data.payments.length > 0) {
                    const tbody = document.getElementById('paymentTableBody');
                    tbody.innerHTML = data.payments.map(p => `
                        <tr>
                            <td>${p.installment}</td>
                            <td>${p.due_date}</td>
                            <td>â‚¹${p.amount}</td>
                            <td><span class="payment-${p.status.toLowerCase()}">${p.status}</span></td>
                            <td>${p.payment_date || '-'}</td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading payments:', error);
            }
        }

        // Initialize
        loadTravelerData();
    </script>
</body>
</html>
