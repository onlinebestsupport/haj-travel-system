<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backup & Restore - Alhudha Haj Travel Admin</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #f5f7fa;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        .admin-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-area i {
            font-size: 2rem;
            color: #f1c40f;
        }

        .logo-area h1 {
            color: white;
            font-size: 1.5rem;
        }

        .role-badge {
            background: #f1c40f;
            color: #2c3e50;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        /* Back to Dashboard */
        .back-link {
            margin: 20px 0;
        }

        .back-link a {
            color: #3498db;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .back-link a:hover {
            color: #2980b9;
        }

        /* Page Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .page-header h2 {
            color: #2c3e50;
            font-size: 1.8rem;
        }

        .page-header h2 i {
            color: #f1c40f;
            margin-right: 10px;
        }

        /* Action Buttons */
        .action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            text-decoration: none;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #219a52;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
            transform: translateY(-2px);
        }

        .btn-info {
            background: #00bcd4;
            color: white;
        }

        .btn-info:hover {
            background: #00a5bb;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        /* Backup Stats */
        .backup-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
            border-left: 4px solid #3498db;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card i {
            font-size: 2.5rem;
            color: #f1c40f;
            margin-bottom: 15px;
        }
        
        .stat-card h3 {
            color: #7f8c8d;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            color: #95a5a6;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        /* Backup List */
        .backup-list {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .list-header h3 {
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .list-header h3 i {
            color: #f1c40f;
        }
        
        .list-filters {
            display: flex;
            gap: 10px;
        }
        
        .list-filters select,
        .list-filters input {
            padding: 8px 12px;
            border: 2px solid #ecf0f1;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .list-filters input:focus,
        .list-filters select:focus {
            border-color: #3498db;
            outline: none;
        }
        
        .backup-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border: 1px solid #ecf0f1;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
            background: #f8f9fa;
        }
        
        .backup-item:hover {
            background: #e8f4f8;
            border-color: #3498db;
            transform: translateX(5px);
        }
        
        .backup-item.restore-point {
            border-left: 4px solid #f39c12;
            background: #fff9e6;
        }
        
        .backup-info {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 1;
        }
        
        .backup-icon {
            width: 50px;
            height: 50px;
            background: #3498db;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }
        
        .backup-icon.restore {
            background: #f39c12;
        }
        
        .backup-details {
            flex: 1;
        }
        
        .backup-details h4 {
            margin-bottom: 5px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .backup-details h4 .badge {
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 12px;
            background: #3498db;
            color: white;
        }
        
        .backup-details h4 .badge.auto {
            background: #27ae60;
        }
        
        .backup-details h4 .badge.manual {
            background: #f39c12;
        }
        
        .backup-details h4 .badge.restore {
            background: #e74c3c;
        }
        
        .backup-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .backup-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .backup-actions {
            display: flex;
            gap: 10px;
        }
        
        .icon-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .icon-btn.restore {
            background: #f39c12;
            color: white;
        }
        
        .icon-btn.download {
            background: #3498db;
            color: white;
        }
        
        .icon-btn.delete {
            background: #e74c3c;
            color: white;
        }
        
        .icon-btn.info {
            background: #27ae60;
            color: white;
        }
        
        .icon-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
        }

        /* Schedule Card */
        .schedule-card {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .schedule-card h3 {
            color: white;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .schedule-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }
        
        .schedule-option {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .schedule-option:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .schedule-option.active {
            background: #f1c40f;
            color: #2c3e50;
            border-color: white;
        }
        
        .schedule-option i {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .schedule-option h4 {
            margin-bottom: 5px;
        }
        
        .schedule-option p {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        /* Settings Card */
        .settings-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 25px;
        }
        
        .settings-card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .settings-card h3 i {
            color: #f1c40f;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .form-group select,
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ecf0f1;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .form-group select:focus,
        .form-group input:focus {
            border-color: #3498db;
            outline: none;
        }

        /* Restore Point Modal */
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 2000;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1999;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }

        .modal-header h3 {
            color: #2c3e50;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #7f8c8d;
        }

        .modal-close:hover {
            color: #e74c3c;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid #ecf0f1;
        }

        /* Restore Preview */
        .restore-preview {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .restore-preview-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .restore-preview-item:last-child {
            border-bottom: none;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #f39c12;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            color: #856404;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            z-index: 9999;
            display: none;
            animation: slideIn 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification-success { background: #27ae60; }
        .notification-error { background: #e74c3c; }
        .notification-info { background: #3498db; }
        .notification-warning { background: #f39c12; }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: #ecf0f1;
            border-radius: 2px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: #27ae60;
            width: 0%;
            transition: width 0.3s;
        }

        @media (max-width: 768px) {
            .backup-item {
                flex-direction: column;
                gap: 15px;
            }
            
            .backup-actions {
                width: 100%;
                justify-content: center;
            }
            
            .backup-meta {
                flex-direction: column;
                gap: 5px;
            }
            
            .schedule-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <div class="container">
            <div class="header-content">
                <div class="logo-area">
                    <i class="fas fa-kaaba"></i>
                    <h1>Alhudha Haj Admin - Backup & Restore</h1>
                    <span class="role-badge" id="roleBadge">Admin</span>
                </div>
                <div>
                    <a href="dashboard.html" class="action-btn btn-info" style="margin-right: 10px; display: inline-flex;">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <button onclick="logout()" class="logout-btn" style="display: inline-flex;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="page-header">
            <h2><i class="fas fa-database"></i> Database Backup & Restore</h2>
            <div>
                <button class="action-btn btn-success" onclick="createBackup('manual')">
                    <i class="fas fa-save"></i> Create New Backup
                </button>
                <button class="action-btn btn-warning" onclick="showRestorePoints()">
                    <i class="fas fa-history"></i> Restore Points
                </button>
                <button class="action-btn btn-info" onclick="verifyBackupIntegrity()">
                    <i class="fas fa-check-circle"></i> Verify Integrity
                </button>
            </div>
        </div>

        <!-- Backup Statistics -->
        <div class="backup-stats">
            <div class="stat-card">
                <i class="fas fa-database"></i>
                <h3>Database Size</h3>
                <div class="stat-value" id="dbSize">2.4 MB</div>
                <div class="stat-label">Current</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-file-archive"></i>
                <h3>Total Backups</h3>
                <div class="stat-value" id="totalBackups">12</div>
                <div class="stat-label">Archives</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-clock"></i>
                <h3>Last Backup</h3>
                <div class="stat-value" id="lastBackup">21 Feb</div>
                <div class="stat-label">2026, 03:00 AM</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-hdd"></i>
                <h3>Storage Used</h3>
                <div class="stat-value" id="storageUsed">156 MB</div>
                <div class="stat-label">of 1 GB</div>
                <div class="progress-bar" style="margin-top: 10px;">
                    <div class="progress-fill" id="storageProgress" style="width: 15.6%;"></div>
                </div>
            </div>
        </div>

        <!-- Backup List -->
        <div class="backup-list">
            <div class="list-header">
                <h3><i class="fas fa-history"></i> Available Backups</h3>
                <div class="list-filters">
                    <input type="text" id="searchBackup" placeholder="Search backups..." onkeyup="searchBackups()">
                    <select id="backupTypeFilter" onchange="filterBackups()">
                        <option value="all">All Types</option>
                        <option value="manual">Manual</option>
                        <option value="auto">Automatic</option>
                        <option value="restore">Restore Points</option>
                    </select>
                </div>
            </div>
            <div id="backupItems">
                <!-- Backup items will be loaded here -->
            </div>
        </div>

        <!-- Auto Backup Schedule -->
        <div class="schedule-card">
            <h3><i class="fas fa-clock"></i> Automatic Backup Schedule</h3>
            <div class="schedule-options">
                <div class="schedule-option" onclick="setSchedule('daily')" id="scheduleDaily">
                    <i class="fas fa-calendar-day"></i>
                    <h4>Daily</h4>
                    <p>Every day at 3 AM</p>
                </div>
                <div class="schedule-option active" onclick="setSchedule('weekly')" id="scheduleWeekly">
                    <i class="fas fa-calendar-week"></i>
                    <h4>Weekly</h4>
                    <p>Every Sunday at 3 AM</p>
                </div>
                <div class="schedule-option" onclick="setSchedule('monthly')" id="scheduleMonthly">
                    <i class="fas fa-calendar-alt"></i>
                    <h4>Monthly</h4>
                    <p>1st of every month</p>
                </div>
                <div class="schedule-option" onclick="setSchedule('manual')" id="scheduleManual">
                    <i class="fas fa-hand"></i>
                    <h4>Manual Only</h4>
                    <p>No automatic backup</p>
                </div>
            </div>
        </div>

        <!-- Backup Settings -->
        <div class="settings-card">
            <h3><i class="fas fa-cog"></i> Backup Settings</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label><i class="fas fa-clock"></i> Keep backups for</label>
                    <select id="retentionDays" onchange="saveSettings()">
                        <option value="7">7 days</option>
                        <option value="30" selected>30 days</option>
                        <option value="60">60 days</option>
                        <option value="90">90 days</option>
                        <option value="180">180 days</option>
                        <option value="365">1 year</option>
                        <option value="0">Forever</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-cloud"></i> Backup location</label>
                    <select id="backupLocation" onchange="saveSettings()">
                        <option value="local">Local server only</option>
                        <option value="cloud">Cloud storage (AWS S3)</option>
                        <option value="both" selected>Both local and cloud</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-compress-alt"></i> Compression level</label>
                    <select id="compression" onchange="saveSettings()">
                        <option value="fast">Fast (low compression)</option>
                        <option value="normal" selected>Normal (recommended)</option>
                        <option value="max">Maximum (slow)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Encryption</label>
                    <select id="encryption" onchange="saveSettings()">
                        <option value="none">No encryption</option>
                        <option value="aes256" selected>AES-256</option>
                        <option value="aes512">AES-512</option>
                    </select>
                </div>
            </div>
            <div class="form-actions">
                <button class="action-btn btn-primary" onclick="saveSettings()">
                    <i class="fas fa-save"></i> Save Settings
                </button>
                <button class="action-btn btn-secondary" onclick="testBackupConnection()">
                    <i class="fas fa-plug"></i> Test Connection
                </button>
            </div>
        </div>
    </div>

    <!-- Restore Preview Modal -->
    <div id="restoreModal" class="modal">
        <div class="modal-header">
            <h3><i class="fas fa-undo-alt"></i> Restore Preview</h3>
            <button class="modal-close" onclick="closeRestoreModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div id="restorePreview"></div>
            <div class="warning-box">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>Warning:</strong> Restoring will overwrite current data. This action cannot be undone.
            </div>
        </div>
        <div class="modal-footer">
            <button class="action-btn btn-danger" onclick="confirmRestore()">
                <i class="fas fa-undo-alt"></i> Confirm Restore
            </button>
            <button class="action-btn btn-secondary" onclick="closeRestoreModal()">
                Cancel
            </button>
        </div>
    </div>

    <!-- Create Restore Point Modal -->
    <div id="restorePointModal" class="modal">
        <div class="modal-header">
            <h3><i class="fas fa-plus-circle"></i> Create Restore Point</h3>
            <button class="modal-close" onclick="closeRestorePointModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Restore Point Name</label>
                <input type="text" id="restorePointName" placeholder="e.g., Before Haj Registration" value="Restore Point - ">
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea id="restorePointDesc" rows="3" placeholder="Why are you creating this restore point?"></textarea>
            </div>
            <div class="form-group">
                <label>Include in backup</label>
                <select id="restorePointInclude">
                    <option value="all">All tables</option>
                    <option value="travelers">Travelers only</option>
                    <option value="payments">Payments only</option>
                    <option value="batches">Batches only</option>
                    <option value="users">Users only</option>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="action-btn btn-success" onclick="createRestorePoint()">
                <i class="fas fa-check"></i> Create Restore Point
            </button>
            <button class="action-btn btn-secondary" onclick="closeRestorePointModal()">
                Cancel
            </button>
        </div>
    </div>

    <!-- Overlay -->
    <div id="modalOverlay" class="modal-overlay" onclick="closeAllModals()"></div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        // ==================== GLOBAL VARIABLES ====================
        let backupSchedule = 'weekly';
        let backupData = [];
        let currentRestoreId = null;

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadBackupData();
            loadBackupList();
            loadSettings();
            
            // Check for auto-backup on page load (if it's logout time)
            checkForLogoutBackup();
        });

        // ==================== AUTHENTICATION ====================
        function checkAuth() {
            const isLoggedIn = sessionStorage.getItem('adminLoggedIn');
            if (!isLoggedIn) {
                window.location.href = '/admin.login.html';
                return;
            }
            const userName = sessionStorage.getItem('adminName') || 'Admin';
            userRole = sessionStorage.getItem('adminRole') || 'admin';
            document.getElementById('roleBadge').textContent = userRole;
        }

        // ==================== LOGOUT WITH AUTO BACKUP ====================
        async function logout() {
            // Create auto backup before logout
            showNotification('Creating auto backup before logout...', 'info');
            
            try {
                await createAutoBackup();
                
                // Clear session after backup
                sessionStorage.clear();
                showNotification('Backup created. Logging out...', 'success');
                
                setTimeout(() => {
                    window.location.href = '/admin.login.html';
                }, 1500);
            } catch (error) {
                console.error('Error creating backup:', error);
                // Still logout even if backup fails
                sessionStorage.clear();
                window.location.href = '/admin.login.html';
            }
        }

        // ==================== NOTIFICATION ====================
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i> ${message}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // ==================== LOAD BACKUP DATA ====================
        function loadBackupData() {
            // Simulate loading from API
            setTimeout(() => {
                document.getElementById('dbSize').textContent = '2.4 MB';
                document.getElementById('totalBackups').textContent = '12';
                document.getElementById('lastBackup').textContent = '21 Feb';
                document.getElementById('storageUsed').textContent = '156 MB';
                document.getElementById('storageProgress').style.width = '15.6%';
            }, 500);
        }

        function loadBackupList() {
            // Demo backup list
            backupData = [
                {
                    id: 'bk1',
                    name: 'Full Backup - 2026-02-21 03:00 AM',
                    date: '2026-02-21',
                    time: '03:00 AM',
                    size: '2.4 MB',
                    tables: 8,
                    type: 'auto',
                    status: 'Completed',
                    location: 'local',
                    restorePoint: false
                },
                {
                    id: 'bk2',
                    name: 'Pre-Haj Registration Restore Point',
                    date: '2026-02-20',
                    time: '10:30 AM',
                    size: '1.8 MB',
                    tables: 5,
                    type: 'manual',
                    status: 'Completed',
                    location: 'both',
                    restorePoint: true,
                    description: 'Created before starting Haj registrations'
                },
                {
                    id: 'bk3',
                    name: 'Full Backup - 2026-02-20 03:00 AM',
                    date: '2026-02-20',
                    time: '03:00 AM',
                    size: '2.3 MB',
                    tables: 8,
                    type: 'auto',
                    status: 'Completed',
                    location: 'local',
                    restorePoint: false
                },
                {
                    id: 'bk4',
                    name: 'Full Backup - 2026-02-19 03:00 AM',
                    date: '2026-02-19',
                    time: '03:00 AM',
                    size: '2.3 MB',
                    tables: 8,
                    type: 'auto',
                    status: 'Completed',
                    location: 'local',
                    restorePoint: false
                },
                {
                    id: 'bk5',
                    name: 'Before Payment Structure Change',
                    date: '2026-02-18',
                    time: '02:15 PM',
                    size: '2.2 MB',
                    tables: 8,
                    type: 'manual',
                    status: 'Completed',
                    location: 'both',
                    restorePoint: true,
                    description: 'Backup before updating payment structure'
                }
            ];
            
            displayBackupList(backupData);
        }

        function displayBackupList(backups) {
            const container = document.getElementById('backupItems');
            container.innerHTML = '';
            
            backups.forEach(backup => {
                const item = document.createElement('div');
                item.className = `backup-item ${backup.restorePoint ? 'restore-point' : ''}`;
                
                const typeClass = backup.type === 'auto' ? 'auto' : (backup.restorePoint ? 'restore' : 'manual');
                const typeLabel = backup.restorePoint ? 'Restore Point' : (backup.type === 'auto' ? 'Auto' : 'Manual');
                
                item.innerHTML = `
                    <div class="backup-info">
                        <div class="backup-icon ${backup.restorePoint ? 'restore' : ''}">
                            <i class="fas ${backup.restorePoint ? 'fa-bookmark' : 'fa-file-archive'}"></i>
                        </div>
                        <div class="backup-details">
                            <h4>
                                ${backup.name}
                                <span class="badge ${typeClass}">${typeLabel}</span>
                                ${backup.restorePoint ? '<span class="badge restore">‚≠ê Restore Point</span>' : ''}
                            </h4>
                            <div class="backup-meta">
                                <span><i class="fas fa-calendar"></i> ${backup.date}</span>
                                <span><i class="fas fa-clock"></i> ${backup.time}</span>
                                <span><i class="fas fa-database"></i> ${backup.size}</span>
                                <span><i class="fas fa-table"></i> ${backup.tables} tables</span>
                                <span><i class="fas fa-map-marker-alt"></i> ${backup.location}</span>
                                ${backup.restorePoint && backup.description ? `<span><i class="fas fa-info-circle" title="${backup.description}"></i></span>` : ''}
                            </div>
                        </div>
                    </div>
                    <div class="backup-actions">
                        <button class="icon-btn restore" onclick="showRestorePreview('${backup.id}')" title="Restore">
                            <i class="fas fa-undo"></i>
                        </button>
                        <button class="icon-btn download" onclick="downloadBackup('${backup.id}')" title="Download">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="icon-btn info" onclick="showBackupInfo('${backup.id}')" title="Details">
                            <i class="fas fa-info"></i>
                        </button>
                        <button class="icon-btn delete" onclick="deleteBackup('${backup.id}')" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }

        // ==================== BACKUP FUNCTIONS ====================
        function createBackup(type = 'manual') {
            showNotification('Creating backup...', 'info');
            
            // Show progress
            const progress = document.createElement('div');
            progress.className = 'progress-bar';
            progress.style.margin = '10px 0';
            progress.innerHTML = '<div class="progress-fill" style="width: 0%;"></div>';
            document.body.appendChild(progress);
            
            let width = 0;
            const interval = setInterval(() => {
                width += 10;
                progress.querySelector('.progress-fill').style.width = width + '%';
                
                if (width >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        progress.remove();
                        
                        // Add new backup to list
                        const newBackup = {
                            id: 'bk' + (backupData.length + 1),
                            name: type === 'auto' ? 'Auto Backup' : 'Manual Backup',
                            date: new Date().toISOString().split('T')[0],
                            time: new Date().toLocaleTimeString(),
                            size: '2.4 MB',
                            tables: 8,
                            type: type,
                            status: 'Completed',
                            location: document.getElementById('backupLocation').value,
                            restorePoint: false
                        };
                        
                        backupData.unshift(newBackup);
                        displayBackupList(backupData);
                        
                        // Update stats
                        document.getElementById('totalBackups').textContent = backupData.length;
                        document.getElementById('lastBackup').textContent = new Date().toLocaleDateString('en-US', { day: 'numeric', month: 'short' });
                        
                        showNotification('Backup created successfully!', 'success');
                    }, 500);
                }
            }, 200);
        }

        async function createAutoBackup() {
            return new Promise((resolve) => {
                showNotification('Auto backup in progress...', 'info');
                
                // Simulate auto backup
                setTimeout(() => {
                    const autoBackup = {
                        id: 'bk' + (backupData.length + 1),
                        name: `Auto Backup - Logout ${new Date().toLocaleString()}`,
                        date: new Date().toISOString().split('T')[0],
                        time: new Date().toLocaleTimeString(),
                        size: '2.4 MB',
                        tables: 8,
                        type: 'auto',
                        status: 'Completed',
                        location: 'local',
                        restorePoint: false
                    };
                    
                    backupData.unshift(autoBackup);
                    
                    // Save to localStorage for demo
                    localStorage.setItem('lastAutoBackup', JSON.stringify(autoBackup));
                    
                    resolve();
                }, 2000);
            });
        }

        function checkForLogoutBackup() {
            // Check if this is a logout-triggered page load
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('logout') === 'true') {
                createAutoBackup();
            }
        }

        // ==================== RESTORE FUNCTIONS ====================
        function showRestorePreview(backupId) {
            const backup = backupData.find(b => b.id === backupId);
            if (!backup) return;
            
            currentRestoreId = backupId;
            
            const preview = document.getElementById('restorePreview');
            preview.innerHTML = `
                <h4 style="margin-bottom: 15px;">Backup Details: ${backup.name}</h4>
                <div class="restore-preview">
                    <div class="restore-preview-item">
                        <span>Created:</span>
                        <strong>${backup.date} ${backup.time}</strong>
                    </div>
                    <div class="restore-preview-item">
                        <span>Size:</span>
                        <strong>${backup.size}</strong>
                    </div>
                    <div class="restore-preview-item">
                        <span>Tables included:</span>
                        <strong>${backup.tables}</strong>
                    </div>
                    <div class="restore-preview-item">
                        <span>Type:</span>
                        <strong>${backup.restorePoint ? 'Restore Point' : (backup.type === 'auto' ? 'Automatic' : 'Manual')}</strong>
                    </div>
                </div>
                <h4 style="margin: 15px 0 10px;">Tables to be restored:</h4>
                <ul style="list-style: none; padding: 0;">
                    <li style="padding: 5px 0;"><i class="fas fa-check-circle" style="color: #27ae60;"></i> travelers (156 records)</li>
                    <li style="padding: 5px 0;"><i class="fas fa-check-circle" style="color: #27ae60;"></i> batches (8 records)</li>
                    <li style="padding: 5px 0;"><i class="fas fa-check-circle" style="color: #27ae60;"></i> payments (245 records)</li>
                    <li style="padding: 5px 0;"><i class="fas fa-check-circle" style="color: #27ae60;"></i> users (12 records)</li>
                    <li style="padding: 5px 0;"><i class="fas fa-check-circle" style="color: #27ae60;"></i> invoices (89 records)</li>
                </ul>
            `;
            
            document.getElementById('restoreModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
        }

        function confirmRestore() {
            showNotification('Restoring backup...', 'info');
            
            setTimeout(() => {
                showNotification('Backup restored successfully! All data has been recovered.', 'success');
                closeRestoreModal();
                
                // Log the restoration
                console.log('Restored from backup:', currentRestoreId);
            }, 3000);
        }

        function closeRestoreModal() {
            document.getElementById('restoreModal').style.display = 'none';
            document.getElementById('modalOverlay').style.display = 'none';
            currentRestoreId = null;
        }

        // ==================== RESTORE POINT FUNCTIONS ====================
        function showRestorePoints() {
            const restorePoints = backupData.filter(b => b.restorePoint);
            
            if (restorePoints.length === 0) {
                showNotification('No restore points found. Create one now?', 'info');
                showCreateRestorePointModal();
            } else {
                // Filter to show only restore points
                filterBackups('restore');
            }
        }

        function showCreateRestorePointModal() {
            // Set default name with timestamp
            const now = new Date();
            document.getElementById('restorePointName').value = `Restore Point - ${now.toLocaleDateString()}`;
            
            document.getElementById('restorePointModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
        }

        function closeRestorePointModal() {
            document.getElementById('restorePointModal').style.display = 'none';
            document.getElementById('modalOverlay').style.display = 'none';
        }

        function createRestorePoint() {
            const name = document.getElementById('restorePointName').value;
            const description = document.getElementById('restorePointDesc').value;
            const include = document.getElementById('restorePointInclude').value;
            
            if (!name) {
                showNotification('Please enter a restore point name', 'error');
                return;
            }
            
            showNotification('Creating restore point...', 'info');
            
            setTimeout(() => {
                const restorePoint = {
                    id: 'rp' + (backupData.length + 1),
                    name: name,
                    date: new Date().toISOString().split('T')[0],
                    time: new Date().toLocaleTimeString(),
                    size: '1.2 MB',
                    tables: include === 'all' ? 8 : 1,
                    type: 'manual',
                    status: 'Completed',
                    location: 'both',
                    restorePoint: true,
                    description: description || 'Manual restore point'
                };
                
                backupData.unshift(restorePoint);
                displayBackupList(backupData);
                
                closeRestorePointModal();
                showNotification('Restore point created successfully!', 'success');
            }, 2000);
        }

        // ==================== BACKUP ACTIONS ====================
        function downloadBackup(backupId) {
            const backup = backupData.find(b => b.id === backupId);
            showNotification(`Downloading ${backup.name}...`, 'info');
            
            // Simulate download
            setTimeout(() => {
                showNotification('Backup downloaded successfully!', 'success');
            }, 1500);
        }

        function showBackupInfo(backupId) {
            const backup = backupData.find(b => b.id === backupId);
            if (!backup) return;
            
            alert(`
Backup Information:
Name: ${backup.name}
Date: ${backup.date} ${backup.time}
Size: ${backup.size}
Tables: ${backup.tables}
Type: ${backup.restorePoint ? 'Restore Point' : backup.type}
Location: ${backup.location}
Status: ${backup.status}
${backup.description ? '\nDescription: ' + backup.description : ''}
            `);
        }

        function deleteBackup(backupId) {
            if (confirm('Are you sure you want to delete this backup? This action cannot be undone.')) {
                backupData = backupData.filter(b => b.id !== backupId);
                displayBackupList(backupData);
                
                // Update stats
                document.getElementById('totalBackups').textContent = backupData.length;
                
                showNotification('Backup deleted successfully!', 'success');
            }
        }

        // ==================== SEARCH AND FILTER ====================
        function searchBackups() {
            const searchTerm = document.getElementById('searchBackup').value.toLowerCase();
            const filtered = backupData.filter(backup => 
                backup.name.toLowerCase().includes(searchTerm) ||
                backup.date.includes(searchTerm) ||
                (backup.description && backup.description.toLowerCase().includes(searchTerm))
            );
            displayBackupList(filtered);
        }

        function filterBackups(type) {
            const filter = type || document.getElementById('backupTypeFilter').value;
            
            let filtered = backupData;
            if (filter !== 'all') {
                if (filter === 'restore') {
                    filtered = backupData.filter(b => b.restorePoint);
                } else {
                    filtered = backupData.filter(b => b.type === filter && !b.restorePoint);
                }
            }
            
            displayBackupList(filtered);
        }

        // ==================== SCHEDULE FUNCTIONS ====================
        function setSchedule(type) {
            backupSchedule = type;
            
            // Remove active class from all
            ['daily', 'weekly', 'monthly', 'manual'].forEach(s => {
                document.getElementById(`schedule${s.charAt(0).toUpperCase() + s.slice(1)}`).classList.remove('active');
            });
            
            // Add active class to selected
            document.getElementById(`schedule${type.charAt(0).toUpperCase() + type.slice(1)}`).classList.add('active');
            
            // Save to localStorage
            localStorage.setItem('backupSchedule', type);
            
            showNotification(`Backup schedule set to ${type}`, 'success');
        }

        // ==================== SETTINGS FUNCTIONS ====================
        function loadSettings() {
            const savedSchedule = localStorage.getItem('backupSchedule');
            if (savedSchedule) {
                setSchedule(savedSchedule);
            }
            
            const savedRetention = localStorage.getItem('backupRetention');
            if (savedRetention) {
                document.getElementById('retentionDays').value = savedRetention;
            }
            
            const savedLocation = localStorage.getItem('backupLocation');
            if (savedLocation) {
                document.getElementById('backupLocation').value = savedLocation;
            }
            
            const savedCompression = localStorage.getItem('backupCompression');
            if (savedCompression) {
                document.getElementById('compression').value = savedCompression;
            }
        }

        function saveSettings() {
            const retention = document.getElementById('retentionDays').value;
            const location = document.getElementById('backupLocation').value;
            const compression = document.getElementById('compression').value;
            const encryption = document.getElementById('encryption').value;
            
            // Save to localStorage
            localStorage.setItem('backupRetention', retention);
            localStorage.setItem('backupLocation', location);
            localStorage.setItem('backupCompression', compression);
            localStorage.setItem('backupEncryption', encryption);
            
            showNotification('Backup settings saved successfully!', 'success');
        }

        function testBackupConnection() {
            showNotification('Testing backup connection...', 'info');
            
            setTimeout(() => {
                showNotification('Connection successful! Backup location is accessible.', 'success');
            }, 2000);
        }

        function verifyBackupIntegrity() {
            showNotification('Verifying backup integrity...', 'info');
            
            setTimeout(() => {
                showNotification('All backups verified successfully! No corruption detected.', 'success');
            }, 3000);
        }

        // ==================== MODAL FUNCTIONS ====================
        function closeAllModals() {
            document.getElementById('restoreModal').style.display = 'none';
            document.getElementById('restorePointModal').style.display = 'none';
            document.getElementById('modalOverlay').style.display = 'none';
        }
    </script>
</body>
</html>
