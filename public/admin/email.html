<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email - Alhudha Haj Travel Admin</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #f5f7fa;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        .admin-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-area i {
            font-size: 2rem;
            color: #f1c40f;
        }

        .logo-area h1 {
            color: white;
            font-size: 1.5rem;
        }

        .role-badge {
            background: #f1c40f;
            color: #2c3e50;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        /* Back to Dashboard */
        .back-link {
            margin: 20px 0;
        }

        .back-link a {
            color: #3498db;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .back-link a:hover {
            color: #2980b9;
        }

        /* Page Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0 20px;
        }

        .page-header h2 {
            color: #2c3e50;
            font-size: 1.8rem;
        }

        .page-header h2 i {
            color: #f1c40f;
            margin-right: 10px;
        }

        /* Action Buttons */
        .action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            text-decoration: none;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #219a52;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
            transform: translateY(-2px);
        }

        .btn-info {
            background: #00bcd4;
            color: white;
        }

        .btn-info:hover {
            background: #00a5bb;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        /* Email Container */
        .email-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 20px;
            height: calc(100vh - 250px);
            min-height: 600px;
            margin-top: 20px;
        }
        
        /* Email Sidebar */
        .email-sidebar {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            overflow-y: auto;
        }
        
        .compose-btn {
            width: 100%;
            padding: 15px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s;
        }
        
        .compose-btn:hover {
            background: #219a52;
            transform: translateY(-2px);
        }
        
        .folder-list {
            list-style: none;
        }
        
        .folder-item {
            padding: 12px 15px;
            margin-bottom: 5px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #2c3e50;
            transition: all 0.3s;
        }
        
        .folder-item:hover {
            background: #f0f0f0;
        }
        
        .folder-item.active {
            background: #e8f4f8;
            color: #3498db;
            font-weight: 600;
            border-left: 3px solid #3498db;
        }
        
        .folder-item i {
            width: 20px;
        }
        
        .badge {
            margin-left: auto;
            background: #e74c3c;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
        }
        
        .email-config-bar {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #3498db;
        }
        
        .config-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        .config-item i {
            color: #3498db;
            width: 20px;
        }
        
        .config-item span {
            color: #2c3e50;
            font-weight: 500;
        }
        
        /* Email List */
        .email-list {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .email-toolbar {
            padding: 15px 20px;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .toolbar-left {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .toolbar-left button {
            padding: 8px 15px;
            background: none;
            border: none;
            cursor: pointer;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 5px;
            border-radius: 5px;
        }
        
        .toolbar-left button:hover {
            background: #f0f0f0;
        }
        
        .email-search {
            flex: 1;
            display: flex;
            gap: 10px;
            max-width: 400px;
        }
        
        .email-search input {
            flex: 1;
            padding: 8px 15px;
            border: 2px solid #ecf0f1;
            border-radius: 5px;
            font-size: 0.95rem;
        }
        
        .email-search input:focus {
            border-color: #3498db;
            outline: none;
        }
        
        .email-items {
            flex: 1;
            overflow-y: auto;
        }
        
        .email-item {
            display: grid;
            grid-template-columns: 30px 30px 200px 250px 1fr 120px;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #ecf0f1;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .email-item:hover {
            background: #f8f9fa;
        }
        
        .email-item.unread {
            background: #f0f7ff;
            font-weight: 600;
        }
        
        .email-item.unread .email-sender {
            font-weight: 600;
        }
        
        .email-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .email-star {
            color: #f1c40f;
            cursor: pointer;
            font-size: 1.1rem;
        }
        
        .email-star:hover {
            color: #f39c12;
        }
        
        .email-sender {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .email-subject {
            color: #2c3e50;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .email-preview {
            color: #7f8c8d;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .email-date {
            text-align: right;
            color: #95a5a6;
            font-size: 0.85rem;
            white-space: nowrap;
        }
        
        .attachment-icon {
            color: #95a5a6;
            margin-left: 5px;
        }
        
        /* Compose Modal */
        .compose-modal {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 600px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
            display: none;
            z-index: 2000;
        }
        
        .compose-header {
            padding: 15px 20px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .compose-header h3 {
            color: white;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .compose-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .compose-close:hover {
            color: #f1c40f;
        }
        
        .compose-body {
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .compose-body input,
        .compose-body select,
        .compose-body textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid #ecf0f1;
            border-radius: 5px;
            font-size: 0.95rem;
        }
        
        .compose-body input:focus,
        .compose-body select:focus,
        .compose-body textarea:focus {
            border-color: #3498db;
            outline: none;
        }
        
        .compose-body textarea {
            height: 200px;
            resize: vertical;
        }
        
        .compose-footer {
            padding: 15px 20px;
            border-top: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .compose-footer-left {
            display: flex;
            gap: 10px;
        }
        
        .compose-footer-right {
            display: flex;
            gap: 10px;
        }
        
        /* Template Selector */
        .template-selector {
            position: fixed;
            bottom: 100px;
            right: 640px;
            width: 350px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.2);
            padding: 15px;
            display: none;
            z-index: 2001;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .template-selector h4 {
            margin-bottom: 15px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .template-item {
            padding: 15px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .template-item:hover {
            background: #e8f4f8;
            border-color: #3498db;
        }
        
        .template-item strong {
            color: #2c3e50;
            display: block;
            margin-bottom: 5px;
        }
        
        .template-item p {
            font-size: 0.85rem;
            color: #7f8c8d;
        }
        
        /* Settings Modal */
        .settings-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 500px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
            display: none;
            z-index: 2000;
        }
        
        .settings-header {
            padding: 15px 20px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .settings-body {
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .settings-group {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .settings-group h5 {
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .settings-row:last-child {
            border-bottom: none;
        }
        
        .settings-label {
            color: #7f8c8d;
        }
        
        .settings-value {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .edit-settings {
            color: #3498db;
            cursor: pointer;
            margin-left: 10px;
        }
        
        /* Modal Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1999;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            z-index: 9999;
            display: none;
            animation: slideIn 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification-success { background: #27ae60; }
        .notification-error { background: #e74c3c; }
        .notification-info { background: #3498db; }
        .notification-warning { background: #f39c12; }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .email-item {
                grid-template-columns: 30px 30px 150px 200px 1fr 100px;
            }
        }

        @media (max-width: 768px) {
            .email-container {
                grid-template-columns: 1fr;
                height: auto;
            }
            .email-item {
                grid-template-columns: 30px 30px 1fr 100px;
                grid-template-areas: 
                    "checkbox star sender date"
                    "subject subject preview preview";
                gap: 10px;
            }
            .compose-modal {
                width: 95%;
                right: 2.5%;
            }
            .template-selector {
                width: 90%;
                right: 5%;
                bottom: 120px;
            }
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <div class="container">
            <div class="header-content">
                <div class="logo-area">
                    <i class="fas fa-kaaba"></i>
                    <h1>Alhudha Haj Admin - Email</h1>
                    <span class="role-badge" id="roleBadge">Admin</span>
                </div>
                <div>
                    <a href="dashboard.html" class="action-btn btn-info" style="margin-right: 10px; display: inline-flex;">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <button onclick="logout()" class="logout-btn" style="display: inline-flex;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="page-header">
            <h2><i class="fas fa-envelope"></i> Email Communication</h2>
            <div>
                <button class="action-btn btn-primary" onclick="checkEmails()">
                    <i class="fas fa-sync"></i> Check Mail
                </button>
                <button class="action-btn btn-success" onclick="openSettings()">
                    <i class="fas fa-cog"></i> Settings
                </button>
                <button class="action-btn btn-info" onclick="refreshEmailConfig()">
                    <i class="fas fa-redo-alt"></i> Refresh Config
                </button>
            </div>
        </div>

        <!-- Email Configuration Bar (Dynamically Loaded) -->
        <div class="email-config-bar" id="emailConfigBar">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h4 style="color: #2c3e50;"><i class="fas fa-envelope"></i> Email Configuration</h4>
                <span class="badge" style="background: #27ae60;">Active</span>
            </div>
            <div class="config-item">
                <i class="fas fa-envelope"></i>
                <span>From Email:</span>
                <strong id="configFromEmail">bookings@alhudha.com</strong>
            </div>
            <div class="config-item">
                <i class="fas fa-reply"></i>
                <span>Reply-To:</span>
                <strong id="configReplyTo">info@alhudha.com</strong>
            </div>
            <div class="config-item">
                <i class="fas fa-tag"></i>
                <span>Subject Prefix:</span>
                <strong id="configSubject">Package Inquiry: </strong>
            </div>
        </div>

        <!-- Email Interface -->
        <div class="email-container">
            <!-- Sidebar -->
            <div class="email-sidebar">
                <button class="compose-btn" onclick="openCompose()">
                    <i class="fas fa-pen"></i> Compose
                </button>
                
                <ul class="folder-list">
                    <li class="folder-item active" onclick="selectFolder('inbox')">
                        <i class="fas fa-inbox"></i> Inbox
                        <span class="badge" id="inboxCount">12</span>
                    </li>
                    <li class="folder-item" onclick="selectFolder('sent')">
                        <i class="fas fa-paper-plane"></i> Sent
                        <span class="badge" id="sentCount">0</span>
                    </li>
                    <li class="folder-item" onclick="selectFolder('drafts')">
                        <i class="fas fa-file"></i> Drafts
                        <span class="badge" id="draftsCount">3</span>
                    </li>
                    <li class="folder-item" onclick="selectFolder('spam')">
                        <i class="fas fa-exclamation-triangle"></i> Spam
                        <span class="badge" id="spamCount">2</span>
                    </li>
                    <li class="folder-item" onclick="selectFolder('trash')">
                        <i class="fas fa-trash"></i> Trash
                    </li>
                </ul>
                
                <hr style="margin: 20px 0; border-color: #ecf0f1;">
                
                <ul class="folder-list">
                    <li class="folder-item" onclick="selectFolder('travelers')">
                        <i class="fas fa-users"></i> Travelers
                    </li>
                    <li class="folder-item" onclick="selectFolder('batches')">
                        <i class="fas fa-layer-group"></i> Batches
                    </li>
                    <li class="folder-item" onclick="selectFolder('payments')">
                        <i class="fas fa-credit-card"></i> Payments
                    </li>
                </ul>
            </div>
            
            <!-- Email List -->
            <div class="email-list">
                <div class="email-toolbar">
                    <div class="toolbar-left">
                        <input type="checkbox" id="selectAll" onclick="toggleSelectAll()">
                        <button onclick="refreshEmails()" title="Refresh"><i class="fas fa-sync-alt"></i></button>
                        <button onclick="archiveSelected()" title="Archive"><i class="fas fa-archive"></i></button>
                        <button onclick="deleteSelected()" title="Delete"><i class="fas fa-trash"></i></button>
                        <button onclick="markAsRead()" title="Mark as Read"><i class="fas fa-envelope-open"></i></button>
                        <button onclick="markAsUnread()" title="Mark as Unread"><i class="fas fa-envelope"></i></button>
                    </div>
                    
                    <div class="email-search">
                        <input type="text" placeholder="Search emails..." id="emailSearch" onkeypress="handleSearchKey(event)">
                        <button onclick="searchEmails()"><i class="fas fa-search"></i></button>
                    </div>
                </div>
                
                <div class="email-items" id="emailItems">
                    <!-- Email items will be loaded dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Compose Modal -->
    <div class="compose-modal" id="composeModal">
        <div class="compose-header">
            <h3><i class="fas fa-pen"></i> New Message</h3>
            <button class="compose-close" onclick="closeCompose()">&times;</button>
        </div>
        <div class="compose-body">
            <select id="composeToGroup" onchange="loadGroupRecipients()">
                <option value="">Select Recipient Group</option>
                <option value="travelers">All Travelers</option>
                <option value="batch1">Haj Platinum 2026</option>
                <option value="batch2">Haj Gold 2026</option>
                <option value="batch3">Umrah Ramadhan</option>
                <option value="pending">Pending Payment</option>
                <option value="completed">Completed Payments</option>
                <option value="custom">Custom Recipients</option>
            </select>
            
            <input type="email" id="composeTo" placeholder="To (comma separated for multiple)">
            <input type="text" id="composeSubject" placeholder="Subject">
            <textarea id="composeBody" placeholder="Message"></textarea>
            
            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <button class="action-btn btn-secondary" style="padding: 8px 15px;" onclick="showTemplates()">
                    <i class="fas fa-template"></i> Templates
                </button>
                <button class="action-btn btn-secondary" style="padding: 8px 15px;" onclick="insertPlaceholder()">
                    <i class="fas fa-code"></i> Insert Placeholder
                </button>
            </div>
            
            <div id="placeholderHelp" style="display: none; background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                <small>Available placeholders: [Traveler Name], [Batch Name], [Amount], [Due Date], [Payment Date], [Transaction ID]</small>
            </div>
        </div>
        <div class="compose-footer">
            <div class="compose-footer-left">
                <button class="action-btn btn-secondary" onclick="saveDraft()">
                    <i class="fas fa-save"></i> Save Draft
                </button>
                <button class="action-btn btn-secondary" onclick="showPlaceholderHelp()">
                    <i class="fas fa-question-circle"></i>
                </button>
            </div>
            <div class="compose-footer-right">
                <button class="action-btn btn-primary" onclick="sendEmail()">
                    <i class="fas fa-paper-plane"></i> Send
                </button>
            </div>
        </div>
    </div>

    <!-- Template Selector -->
    <div class="template-selector" id="templateSelector">
        <h4><i class="fas fa-template"></i> Email Templates</h4>
        <div class="template-item" onclick="useTemplate('payment')">
            <strong>Payment Reminder</strong>
            <p>Remind travelers about pending payments</p>
        </div>
        <div class="template-item" onclick="useTemplate('document')">
            <strong>Document Request</strong>
            <p>Request missing documents</p>
        </div>
        <div class="template-item" onclick="useTemplate('visa')">
            <strong>Visa Update</strong>
            <p>Send visa status updates</p>
        </div>
        <div class="template-item" onclick="useTemplate('welcome')">
            <strong>Welcome Email</strong>
            <p>Welcome new travelers</p>
        </div>
        <div class="template-item" onclick="useTemplate('thankyou')">
            <strong>Thank You</strong>
            <p>Thank travelers for their payment</p>
        </div>
        <div class="template-item" onclick="useTemplate('flight')">
            <strong>Flight Details</strong>
            <p>Share flight schedules and updates</p>
        </div>
        <div class="template-item" onclick="useTemplate('deadline')">
            <strong>Deadline Reminder</strong>
            <p>Remind about document submission deadlines</p>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-header">
            <h3><i class="fas fa-cog"></i> Email Settings</h3>
            <button class="compose-close" onclick="closeSettings()">&times;</button>
        </div>
        <div class="settings-body">
            <div class="settings-group">
                <h5><i class="fas fa-envelope"></i> SMTP Configuration</h5>
                <div class="settings-row">
                    <span class="settings-label">SMTP Server:</span>
                    <span class="settings-value" id="smtpServer">smtp.gmail.com</span>
                </div>
                <div class="settings-row">
                    <span class="settings-label">SMTP Port:</span>
                    <span class="settings-value" id="smtpPort">587</span>
                </div>
                <div class="settings-row">
                    <span class="settings-label">Encryption:</span>
                    <span class="settings-value" id="smtpEncryption">TLS</span>
                </div>
            </div>
            
            <div class="settings-group">
                <h5><i class="fas fa-envelope-open-text"></i> Email Addresses</h5>
                <div class="settings-row">
                    <span class="settings-label">From Email:</span>
                    <span class="settings-value" id="settingsFromEmail">bookings@alhudha.com</span>
                    <i class="fas fa-edit edit-settings" onclick="editSetting('fromEmail')"></i>
                </div>
                <div class="settings-row">
                    <span class="settings-label">Reply-To:</span>
                    <span class="settings-value" id="settingsReplyTo">info@alhudha.com</span>
                    <i class="fas fa-edit edit-settings" onclick="editSetting('replyTo')"></i>
                </div>
                <div class="settings-row">
                    <span class="settings-label">Subject Prefix:</span>
                    <span class="settings-value" id="settingsSubject">[Alhudha] </span>
                    <i class="fas fa-edit edit-settings" onclick="editSetting('subjectPrefix')"></i>
                </div>
            </div>
            
            <div class="settings-group">
                <h5><i class="fas fa-shield-alt"></i> Security</h5>
                <div class="settings-row">
                    <span class="settings-label">SPF Record:</span>
                    <span class="settings-value">✓ Verified</span>
                </div>
                <div class="settings-row">
                    <span class="settings-label">DKIM Signature:</span>
                    <span class="settings-value">✓ Active</span>
                </div>
                <div class="settings-row">
                    <span class="settings-label">DMARC Policy:</span>
                    <span class="settings-value">✓ Pass</span>
                </div>
            </div>
        </div>
        <div class="compose-footer" style="justify-content: flex-end;">
            <button class="action-btn btn-primary" onclick="closeSettings()">Close</button>
        </div>
    </div>

    <!-- Overlay -->
    <div id="modalOverlay" class="modal-overlay" onclick="closeAllModals()"></div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        // ==================== GLOBAL VARIABLES ====================
        let currentFolder = 'inbox';
        let emailConfig = {
            fromEmail: 'bookings@alhudha.com',
            replyTo: 'info@alhudha.com',
            subjectPrefix: '[Alhudha] '
        };
        let draftEmails = [];
        let starredEmails = new Set();

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadEmailConfig();
            loadEmails('inbox');
            loadCounts();
        });

        // ==================== AUTHENTICATION ====================
        function checkAuth() {
            const isLoggedIn = sessionStorage.getItem('adminLoggedIn');
            if (!isLoggedIn) {
                window.location.href = '/admin.login.html';
                return;
            }
            const userName = sessionStorage.getItem('adminName') || 'Admin';
            userRole = sessionStorage.getItem('adminRole') || 'admin';
            document.getElementById('roleBadge').textContent = userRole;
        }

        // ==================== LOGOUT ====================
        function logout() {
            sessionStorage.clear();
            window.location.href = '/admin.login.html';
        }

        // ==================== NOTIFICATION ====================
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i> ${message}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // ==================== LOAD EMAIL CONFIG FROM FRONTPAGE ====================
        function loadEmailConfig() {
            // Try to load from localStorage (set by frontpage)
            const savedFromEmail = localStorage.getItem('bookingEmail');
            const savedSubjectPrefix = localStorage.getItem('emailSubject');
            const savedFooterEmail = localStorage.getItem('footerEmail');
            
            if (savedFromEmail) {
                emailConfig.fromEmail = savedFromEmail;
                emailConfig.replyTo = savedFooterEmail || savedFromEmail;
            }
            
            if (savedSubjectPrefix) {
                emailConfig.subjectPrefix = savedSubjectPrefix;
            }
            
            // Update display
            document.getElementById('configFromEmail').textContent = emailConfig.fromEmail;
            document.getElementById('configReplyTo').textContent = emailConfig.replyTo;
            document.getElementById('configSubject').textContent = emailConfig.subjectPrefix;
            
            document.getElementById('settingsFromEmail').textContent = emailConfig.fromEmail;
            document.getElementById('settingsReplyTo').textContent = emailConfig.replyTo;
            document.getElementById('settingsSubject').textContent = emailConfig.subjectPrefix;
            
            // Also try to fetch from API
            fetch('/api/frontpage/email')
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        if (data.bookingEmail) {
                            emailConfig.fromEmail = data.bookingEmail;
                            emailConfig.replyTo = data.footerEmail || data.bookingEmail;
                        }
                        if (data.emailSubject) {
                            emailConfig.subjectPrefix = data.emailSubject;
                        }
                        
                        // Update display
                        document.getElementById('configFromEmail').textContent = emailConfig.fromEmail;
                        document.getElementById('configReplyTo').textContent = emailConfig.replyTo;
                        document.getElementById('configSubject').textContent = emailConfig.subjectPrefix;
                        
                        document.getElementById('settingsFromEmail').textContent = emailConfig.fromEmail;
                        document.getElementById('settingsReplyTo').textContent = emailConfig.replyTo;
                        document.getElementById('settingsSubject').textContent = emailConfig.subjectPrefix;
                        
                        // Save to localStorage
                        localStorage.setItem('bookingEmail', emailConfig.fromEmail);
                        localStorage.setItem('footerEmail', emailConfig.replyTo);
                        localStorage.setItem('emailSubject', emailConfig.subjectPrefix);
                    }
                })
                .catch(err => console.log('Using localStorage email config'));
        }

        function refreshEmailConfig() {
            loadEmailConfig();
            showNotification('Email configuration refreshed from frontpage', 'success');
        }

        // ==================== LOAD EMAILS ====================
        function loadEmails(folder) {
            const emailItems = document.getElementById('emailItems');
            
            // Demo emails based on folder
            if (folder === 'inbox') {
                emailItems.innerHTML = `
                    <div class="email-item unread" onclick="openEmail(this)" data-id="1">
                        <input type="checkbox" class="email-checkbox" onclick="event.stopPropagation()">
                        <i class="far fa-star email-star" onclick="toggleStar(this, event)"></i>
                        <div class="email-sender">Ahmed Khan</div>
                        <div class="email-subject">Payment Confirmation</div>
                        <div class="email-preview">I have made the payment of ₹85,000 via bank transfer...</div>
                        <div class="email-date">10:30 AM</div>
                    </div>
                    
                    <div class="email-item unread" onclick="openEmail(this)" data-id="2">
                        <input type="checkbox" class="email-checkbox" onclick="event.stopPropagation()">
                        <i class="fas fa-star email-star" onclick="toggleStar(this, event)" style="color: #f1c40f;"></i>
                        <div class="email-sender">Fatima Begum</div>
                        <div class="email-subject">Document Submission</div>
                        <div class="email-preview">I have uploaded all the required documents as per your request...</div>
                        <div class="email-date">Yesterday</div>
                    </div>
                    
                    <div class="email-item" onclick="openEmail(this)" data-id="3">
                        <input type="checkbox" class="email-checkbox" onclick="event.stopPropagation()">
                        <i class="far fa-star email-star" onclick="toggleStar(this, event)"></i>
                        <div class="email-sender">Mohammed Rafiq</div>
                        <div class="email-subject">Visa Query</div>
                        <div class="email-preview">When will the visa be ready? I need to plan my travel...</div>
                        <div class="email-date">2 days ago</div>
                    </div>
                    
                    <div class="email-item" onclick="openEmail(this)" data-id="4">
                        <input type="checkbox" class="email-checkbox" onclick="event.stopPropagation()">
                        <i class="far fa-star email-star" onclick="toggleStar(this, event)"></i>
                        <div class="email-sender">Aisha Begum</div>
                        <div class="email-subject">Travel Insurance</div>
                        <div class="email-preview">Do we need to purchase travel insurance separately or is it included?...</div>
                        <div class="email-date">3 days ago</div>
                    </div>
                    
                    <div class="email-item" onclick="openEmail(this)" data-id="5">
                        <input type="checkbox" class="email-checkbox" onclick="event.stopPropagation()">
                        <i class="fas fa-star email-star" onclick="toggleStar(this, event)" style="color: #f1c40f;"></i>
                        <div class="email-sender">Omar Farooq</div>
                        <div class="email-subject">Accommodation Preference</div>
                        <div class="email-preview">I would like to request a room near the elevator due to mobility issues...</div>
                        <div class="email-date">5 days ago</div>
                    </div>
                `;
            } else if (folder === 'sent') {
                emailItems.innerHTML = `
                    <div class="email-item" onclick="openEmail(this)" data-id="6">
                        <input type="checkbox" class="email-checkbox" onclick="event.stopPropagation()">
                        <i class="far fa-star email-star" onclick="toggleStar(this, event)"></i>
                        <div class="email-sender">To: Ahmed Khan</div>
                        <div class="email-subject">Payment Schedule</div>
                        <div class="email-preview">Your payment schedule for Haj Platinum 2026...</div>
                        <div class="email-date">Yesterday</div>
                    </div>
                    <div class="email-item" onclick="openEmail(this)" data-id="7">
                        <input type="checkbox" class="email-checkbox" onclick="event.stopPropagation()">
                        <i class="far fa-star email-star" onclick="toggleStar(this, event)"></i>
                        <div class="email-sender">To: Fatima Begum</div>
                        <div class="email-subject">Document Received</div>
                        <div class="email-preview">We have received your documents...</div>
                        <div class="email-date">2 days ago</div>
                    </div>
                `;
            } else if (folder === 'drafts') {
                emailItems.innerHTML = `
                    <div class="email-item" onclick="openEmail(this)" data-id="8">
                        <input type="checkbox" class="email-checkbox" onclick="event.stopPropagation()">
                        <i class="far fa-star email-star" onclick="toggleStar(this, event)"></i>
                        <div class="email-sender">Draft</div>
                        <div class="email-subject">Welcome Email for New Batch</div>
                        <div class="email-preview">Dear travelers, welcome to Haj Platinum 2026...</div>
                        <div class="email-date">Saved: 1 hour ago</div>
                    </div>
                `;
            } else {
                emailItems.innerHTML = '<div style="text-align: center; padding: 50px; color: #7f8c8d;">No emails in this folder</div>';
            }
            
            // Restore starred state
            document.querySelectorAll('.email-star').forEach(star => {
                const emailItem = star.closest('.email-item');
                if (emailItem && starredEmails.has(emailItem.dataset.id)) {
                    star.classList.remove('far');
                    star.classList.add('fas');
                    star.style.color = '#f1c40f';
                }
            });
        }

        function loadCounts() {
            document.getElementById('inboxCount').textContent = '12';
            document.getElementById('sentCount').textContent = '8';
            document.getElementById('draftsCount').textContent = '3';
            document.getElementById('spamCount').textContent = '2';
        }

        // ==================== FOLDER SELECTION ====================
        function selectFolder(folder) {
            currentFolder = folder;
            
            document.querySelectorAll('.folder-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            loadEmails(folder);
            showNotification(`Switched to ${folder} folder`, 'info');
        }

        // ==================== COMPOSE FUNCTIONS ====================
        function openCompose() {
            document.getElementById('composeModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
            
            // Pre-fill subject prefix if empty
            const subjectInput = document.getElementById('composeSubject');
            if (!subjectInput.value) {
                subjectInput.value = emailConfig.subjectPrefix;
            }
        }

        function closeCompose() {
            document.getElementById('composeModal').style.display = 'none';
            document.getElementById('templateSelector').style.display = 'none';
            document.getElementById('modalOverlay').style.display = 'none';
            document.getElementById('composeTo').value = '';
            document.getElementById('composeToGroup').value = '';
            document.getElementById('composeSubject').value = '';
            document.getElementById('composeBody').value = '';
            document.getElementById('placeholderHelp').style.display = 'none';
        }

        function loadGroupRecipients() {
            const group = document.getElementById('composeToGroup').value;
            const toInput = document.getElementById('composeTo');
            
            if (group === 'travelers') {
                toInput.value = 'all-travelers@alhudha.com';
                toInput.readOnly = true;
            } else if (group === 'batch1') {
                toInput.value = 'haj-platinum-2026@alhudha.com';
                toInput.readOnly = true;
            } else if (group === 'batch2') {
                toInput.value = 'haj-gold-2026@alhudha.com';
                toInput.readOnly = true;
            } else if (group === 'batch3') {
                toInput.value = 'umrah-ramadhan@alhudha.com';
                toInput.readOnly = true;
            } else if (group === 'pending') {
                toInput.value = 'pending-payments@alhudha.com';
                toInput.readOnly = true;
            } else if (group === 'completed') {
                toInput.value = 'completed-payments@alhudha.com';
                toInput.readOnly = true;
            } else {
                toInput.value = '';
                toInput.readOnly = false;
            }
        }

        function showTemplates() {
            const templateSelector = document.getElementById('templateSelector');
            templateSelector.style.display = templateSelector.style.display === 'block' ? 'none' : 'block';
        }

        function useTemplate(type) {
            const subject = document.getElementById('composeSubject');
            const body = document.getElementById('composeBody');
            
            const templates = {
                payment: {
                    subject: emailConfig.subjectPrefix + "Payment Reminder",
                    body: "Dear [Traveler Name],\n\nThis is a reminder that your next payment of ₹[Amount] is due on [Due Date]. Please make the payment at your earliest convenience.\n\nPayment Details:\nBank: XYZ Bank\nAccount: 123456789\nIFSC: XYZB0001234\n\nJazakAllah Khair,\nAlhudha Haj Travel Team"
                },
                document: {
                    subject: emailConfig.subjectPrefix + "Document Request",
                    body: "Dear [Traveler Name],\n\nWe need the following documents to complete your visa process:\n- Passport copy (first and last page)\n- Recent passport size photograph\n- Vaccination certificate\n- Medical fitness certificate\n\nPlease upload these documents through your traveler portal at your earliest convenience.\n\nJazakAllah Khair,\nAlhudha Haj Travel Team"
                },
                visa: {
                    subject: emailConfig.subjectPrefix + "Visa Update",
                    body: "Dear [Traveler Name],\n\nYour visa application status has been updated.\n\nCurrent Status: [STATUS]\n\nWe will notify you once the visa is ready for collection.\n\nJazakAllah Khair,\nAlhudha Haj Travel Team"
                },
                welcome: {
                    subject: emailConfig.subjectPrefix + "Welcome to Alhudha Haj Travel",
                    body: "Dear [Traveler Name],\n\nAssalamu Alaikum! Welcome to Alhudha Haj Travel.\n\nWe are pleased to have you with us for your spiritual journey. Our team will guide you through every step of the process.\n\nYour registered details:\nBatch: [Batch Name]\nDeparture: [Departure Date]\n\nPlease complete your profile and upload the required documents through your traveler portal.\n\nJazakAllah Khair,\nAlhudha Haj Travel Team"
                },
                thankyou: {
                    subject: emailConfig.subjectPrefix + "Thank You for Your Payment",
                    body: "Dear [Traveler Name],\n\nJazakAllah Khair for your payment of ₹[Amount]. We have received it successfully.\n\nPayment Details:\nAmount: ₹[Amount]\nDate: [Payment Date]\nTransaction ID: [Transaction ID]\n\nMay Allah accept your efforts and grant you a blessed journey.\n\nJazakAllah Khair,\nAlhudha Haj Travel Team"
                },
                flight: {
                    subject: emailConfig.subjectPrefix + "Flight Details",
                    body: "Dear [Traveler Name],\n\nYour flight details have been confirmed:\n\nDeparture: [Departure Date] at [Departure Time]\nFlight: [Flight Number]\n\nPlease be at the airport at least 3 hours before departure.\n\nJazakAllah Khair,\nAlhudha Haj Travel Team"
                },
                deadline: {
                    subject: emailConfig.subjectPrefix + "Document Submission Deadline",
                    body: "Dear [Traveler Name],\n\nThis is a reminder that the deadline for document submission is [Due Date]. Please ensure all documents are uploaded before the deadline to avoid any delays in your visa processing.\n\nJazakAllah Khair,\nAlhudha Haj Travel Team"
                }
            };
            
            if (templates[type]) {
                subject.value = templates[type].subject;
                body.value = templates[type].body;
                document.getElementById('templateSelector').style.display = 'none';
                showNotification('Template loaded', 'success');
            }
        }

        function showPlaceholderHelp() {
            const help = document.getElementById('placeholderHelp');
            help.style.display = help.style.display === 'block' ? 'none' : 'block';
        }

        function insertPlaceholder() {
            const body = document.getElementById('composeBody');
            const placeholder = prompt('Enter placeholder name (e.g., Traveler Name, Batch Name, Amount):');
            if (placeholder) {
                body.value += ` [${placeholder}]`;
            }
        }

        function saveDraft() {
            const draft = {
                id: Date.now(),
                to: document.getElementById('composeTo').value,
                subject: document.getElementById('composeSubject').value,
                body: document.getElementById('composeBody').value,
                timestamp: new Date().toISOString()
            };
            
            draftEmails.push(draft);
            localStorage.setItem('emailDrafts', JSON.stringify(draftEmails));
            
            showNotification('Draft saved', 'success');
            closeCompose();
        }

        function sendEmail() {
            const to = document.getElementById('composeTo').value;
            const subject = document.getElementById('composeSubject').value;
            const body = document.getElementById('composeBody').value;
            
            if (!to || !subject || !body) {
                showNotification('Please fill all fields', 'error');
                return;
            }
            
            // Validate email configuration
            if (!emailConfig.fromEmail || !emailConfig.replyTo) {
                showNotification('Email configuration incomplete. Please check frontpage settings.', 'error');
                return;
            }
            
            showNotification('Sending email...', 'info');
            
            // Simulate sending
            setTimeout(() => {
                showNotification('Email sent successfully!', 'success');
                closeCompose();
                
                // Update sent count
                const sentCount = document.getElementById('sentCount');
                sentCount.textContent = parseInt(sentCount.textContent) + 1;
            }, 2000);
        }

        // ==================== EMAIL INTERACTION ====================
        function openEmail(element) {
            element.classList.remove('unread');
            
            // Get email data
            const sender = element.querySelector('.email-sender').textContent;
            const subject = element.querySelector('.email-subject').textContent;
            const preview = element.querySelector('.email-preview').textContent;
            
            showNotification(`Opening email from ${sender}`, 'info');
            
            // In a real app, this would open the email in a modal
        }

        function toggleStar(element, event) {
            event.stopPropagation();
            const emailItem = element.closest('.email-item');
            const emailId = emailItem.dataset.id;
            
            if (element.classList.contains('fas')) {
                element.classList.remove('fas');
                element.classList.add('far');
                element.style.color = '';
                starredEmails.delete(emailId);
            } else {
                element.classList.remove('far');
                element.classList.add('fas');
                element.style.color = '#f1c40f';
                starredEmails.add(emailId);
            }
        }

        function toggleSelectAll() {
            const checkboxes = document.querySelectorAll('.email-checkbox');
            const selectAll = document.getElementById('selectAll');
            
            checkboxes.forEach(cb => {
                cb.checked = selectAll.checked;
            });
        }

        function refreshEmails() {
            showNotification('Refreshing emails...', 'info');
            
            setTimeout(() => {
                loadEmails(currentFolder);
                showNotification('Emails refreshed', 'success');
            }, 1500);
        }

        function archiveSelected() {
            const checked = document.querySelectorAll('.email-checkbox:checked');
            if (checked.length === 0) {
                showNotification('No emails selected', 'error');
                return;
            }
            
            showNotification(`Archiving ${checked.length} email(s)...`, 'info');
            
            setTimeout(() => {
                // Remove selected emails
                checked.forEach(cb => {
                    const emailItem = cb.closest('.email-item');
                    if (emailItem) emailItem.remove();
                });
                showNotification('Emails archived', 'success');
            }, 1500);
        }

        function deleteSelected() {
            const checked = document.querySelectorAll('.email-checkbox:checked');
            if (checked.length === 0) {
                showNotification('No emails selected', 'error');
                return;
            }
            
            if (confirm(`Delete ${checked.length} email(s)?`)) {
                showNotification(`Deleting ${checked.length} email(s)...`, 'info');
                
                setTimeout(() => {
                    // Remove selected emails
                    checked.forEach(cb => {
                        const emailItem = cb.closest('.email-item');
                        if (emailItem) emailItem.remove();
                    });
                    showNotification('Emails deleted', 'success');
                }, 1500);
            }
        }

        function markAsRead() {
            const checked = document.querySelectorAll('.email-checkbox:checked');
            checked.forEach(cb => {
                const emailItem = cb.closest('.email-item');
                if (emailItem) {
                    emailItem.classList.remove('unread');
                }
            });
            
            showNotification('Marked as read', 'success');
        }

        function markAsUnread() {
            const checked = document.querySelectorAll('.email-checkbox:checked');
            checked.forEach(cb => {
                const emailItem = cb.closest('.email-item');
                if (emailItem) {
                    emailItem.classList.add('unread');
                }
            });
            
            showNotification('Marked as unread', 'success');
        }

        function searchEmails() {
            const search = document.getElementById('emailSearch').value;
            if (!search) {
                showNotification('Please enter search term', 'error');
                return;
            }
            
            showNotification(`Searching for: ${search}`, 'info');
            
            // Simulate search
            setTimeout(() => {
                const items = document.querySelectorAll('.email-item');
                let found = 0;
                
                items.forEach(item => {
                    const text = item.textContent.toLowerCase();
                    if (text.includes(search.toLowerCase())) {
                        item.style.display = 'grid';
                        found++;
                    } else {
                        item.style.display = 'none';
                    }
                });
                
                showNotification(`Found ${found} matching emails`, 'info');
            }, 1000);
        }

        function handleSearchKey(event) {
            if (event.key === 'Enter') {
                searchEmails();
            }
        }

        // ==================== SETTINGS FUNCTIONS ====================
        function openSettings() {
            document.getElementById('settingsModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
        }

        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
            document.getElementById('modalOverlay').style.display = 'none';
        }

        function editSetting(setting) {
            const currentValue = {
                fromEmail: emailConfig.fromEmail,
                replyTo: emailConfig.replyTo,
                subjectPrefix: emailConfig.subjectPrefix
            }[setting];
            
            const newValue = prompt(`Edit ${setting}:`, currentValue);
            if (newValue) {
                // Update in memory
                emailConfig[setting] = newValue;
                
                // Update display
                document.getElementById(`settings${setting.charAt(0).toUpperCase() + setting.slice(1)}`).textContent = newValue;
                document.getElementById(`config${setting.charAt(0).toUpperCase() + setting.slice(1)}`).textContent = newValue;
                
                // Save to localStorage for frontpage
                if (setting === 'fromEmail') localStorage.setItem('bookingEmail', newValue);
                if (setting === 'replyTo') localStorage.setItem('footerEmail', newValue);
                if (setting === 'subjectPrefix') localStorage.setItem('emailSubject', newValue);
                
                showNotification('Setting updated', 'success');
            }
        }

        // ==================== CHECK EMAILS ====================
        function checkEmails() {
            showNotification('Checking for new emails...', 'info');
            
            setTimeout(() => {
                const inboxCount = document.getElementById('inboxCount');
                inboxCount.textContent = parseInt(inboxCount.textContent) + 1;
                showNotification('1 new email received', 'success');
                loadEmails('inbox');
            }, 2000);
        }

        // ==================== CLOSE ALL MODALS ====================
        function closeAllModals() {
            document.getElementById('composeModal').style.display = 'none';
            document.getElementById('templateSelector').style.display = 'none';
            document.getElementById('settingsModal').style.display = 'none';
            document.getElementById('modalOverlay').style.display = 'none';
            document.getElementById('placeholderHelp').style.display = 'none';
        }

        // ==================== LOAD DRAFTS ====================
        function loadDrafts() {
            const saved = localStorage.getItem('emailDrafts');
            if (saved) {
                draftEmails = JSON.parse(saved);
            }
        }

        // ==================== CLICK OUTSIDE HANDLER ====================
        window.onclick = function(event) {
            const composeModal = document.getElementById('composeModal');
            const templateSelector = document.getElementById('templateSelector');
            const settingsModal = document.getElementById('settingsModal');
            
            if (event.target == composeModal) {
                closeCompose();
            }
            
            if (event.target == settingsModal) {
                closeSettings();
            }
            
            if (!event.target.closest('.template-selector') && !event.target.closest('[onclick="showTemplates()"]')) {
                templateSelector.style.display = 'none';
            }
        }

        // Load drafts on startup
        loadDrafts();
    </script>
</body>
</html>
