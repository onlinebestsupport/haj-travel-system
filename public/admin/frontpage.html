<div class="action-buttons">
    <button class="action-btn btn-primary" onclick="saveFrontPage()">
        <i class="fas fa-save"></i> Save Changes
    </button>
    <button class="action-btn btn-success" onclick="previewFrontPage()">
        <i class="fas fa-eye"></i> Preview
    </button>
    <button class="action-btn btn-info" onclick="loadFrontPage()">
        <i class="fas fa-sync-alt"></i> Refresh
    </button>
</div>

<!-- Hero Section Editor -->
<div class="dashboard-card">
    <h3><i class="fas fa-camera"></i> Hero Section</h3>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px;">
        <div>
            <div class="form-group">
                <label>Hero Title</label>
                <input type="text" id="heroTitle" value="Your Journey to the Holy Land" class="form-control">
            </div>
            <div class="form-group">
                <label>Hero Subtitle</label>
                <textarea id="heroSubtitle" rows="2" class="form-control">Experience the spiritual journey of a lifetime with our premium Haj and Umrah packages.</textarea>
            </div>
            <div class="form-group">
                <label>Button Text</label>
                <input type="text" id="heroButtonText" value="View Packages" class="form-control">
            </div>
            <div class="form-group">
                <label>Button Link</label>
                <input type="text" id="heroButtonLink" value="#packages" class="form-control">
            </div>
        </div>
        <div>
            <div class="form-group">
                <label>Background Image</label>
                <div class="document-upload" onclick="document.getElementById('heroImage').click()">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p id="heroImageText">Click to upload image</p>
                    <input type="file" id="heroImage" accept="image/*" style="display: none;" onchange="previewHeroImage(this)">
                </div>
            </div>
            <div class="form-group">
                <label>Image Credit</label>
                <input type="text" id="heroImageCredit" value="Unsplash" class="form-control">
            </div>
            <div style="margin-top: 20px;">
                <img id="heroPreview" src="" alt="Hero preview" style="max-width: 100%; max-height: 150px; border-radius: 5px; display: none;">
            </div>
        </div>
    </div>
</div>

<!-- Company Info Editor -->
<div class="dashboard-card">
    <h3><i class="fas fa-building"></i> Company Information</h3>
    <div class="form-grid">
        <div class="form-group">
            <label>Company Name</label>
            <input type="text" id="companyName" value="Alhudha Haj Travel" class="form-control">
        </div>
        <div class="form-group">
            <label>Company Tagline</label>
            <input type="text" id="companyTagline" value="Your Trusted Partner for Spiritual Journey" class="form-control">
        </div>
        <div class="form-group">
            <label>Established Badge</label>
            <input type="text" id="companyBadge" value="Est. 1998" class="form-control">
        </div>
        <div class="form-group full-width">
            <label>Company Description</label>
            <textarea id="companyDescription" rows="3" class="form-control">25+ years of experience serving pilgrims with premium accommodations, VIP transportation, and expert guides.</textarea>
        </div>
    </div>
</div>

<!-- Features Editor -->
<div class="dashboard-card">
    <h3><i class="fas fa-star"></i> Features Section</h3>
    <div id="featuresContainer">
        <!-- Features will be loaded here -->
    </div>
    <button class="action-btn btn-secondary" onclick="addFeature()" style="margin-top: 20px;">
        <i class="fas fa-plus"></i> Add Feature
    </button>
</div>

<!-- Packages Section Editor -->
<div class="dashboard-card">
    <h3><i class="fas fa-layer-group"></i> Packages Section</h3>
    <div class="form-grid">
        <div class="form-group">
            <label>Section Title</label>
            <input type="text" id="packagesTitle" value="Our Haj & Umrah Packages" class="form-control">
        </div>
        <div class="form-group">
            <label>Section Subtitle</label>
            <input type="text" id="packagesSubtitle" value="Choose from our carefully curated packages" class="form-control">
        </div>
        <div class="form-group">
            <label>Display Style</label>
            <select id="packagesStyle">
                <option value="grid">Grid View</option>
                <option value="list">List View</option>
                <option value="carousel">Carousel</option>
            </select>
        </div>
        <div class="form-group">
            <label>Packages Per Row</label>
            <select id="packagesPerRow">
                <option value="2">2 per row</option>
                <option value="3" selected>3 per row</option>
                <option value="4">4 per row</option>
            </select>
        </div>
    </div>
    
    <h4 style="margin: 20px 0 10px;">Featured Packages</h4>
    <div id="featuredPackages">
        <!-- Package selection -->
    </div>
</div>

<!-- CTA Section Editor -->
<div class="dashboard-card">
    <h3><i class="fas fa-bullhorn"></i> Call to Action Section</h3>
    <div class="form-grid">
        <div class="form-group">
            <label>CTA Title</label>
            <input type="text" id="ctaTitle" value="Ready to Start Your Journey?" class="form-control">
        </div>
        <div class="form-group">
            <label>CTA Description</label>
            <input type="text" id="ctaDesc" value="Fill the 33-field application form to register" class="form-control">
        </div>
        <div class="form-group">
            <label>Left Button Text</label>
            <input type="text" id="ctaLeftText" value="Traveler Login" class="form-control">
        </div>
        <div class="form-group">
            <label>Left Button Link</label>
            <input type="text" id="ctaLeftLink" value="traveler_login.html" class="form-control">
        </div>
        <div class="form-group">
            <label>Right Button Text</label>
            <input type="text" id="ctaRightText" value="Admin Panel" class="form-control">
        </div>
        <div class="form-group">
            <label>Right Button Link</label>
            <input type="text" id="ctaRightLink" value="admin.login.html" class="form-control">
        </div>
    </div>
</div>

<!-- Contact Info Editor -->
<div class="dashboard-card">
    <h3><i class="fas fa-phone"></i> Contact Information</h3>
    <div class="form-grid">
        <div class="form-group">
            <label>Phone 1</label>
            <input type="text" id="contactPhone1" value="+91 98765 43210" class="form-control">
        </div>
        <div class="form-group">
            <label>Phone 2</label>
            <input type="text" id="contactPhone2" value="+91 98765 43211" class="form-control">
        </div>
        <div class="form-group">
            <label>Email 1</label>
            <input type="email" id="contactEmail1" value="info@alhudha.com" class="form-control">
        </div>
        <div class="form-group">
            <label>Email 2</label>
            <input type="email" id="contactEmail2" value="support@alhudha.com" class="form-control">
        </div>
        <div class="form-group full-width">
            <label>Office Address</label>
            <textarea id="contactAddress" rows="2" class="form-control">123, Haj House, Mumbai - 400001, India</textarea>
        </div>
    </div>
</div>

<!-- Social Media Links -->
<div class="dashboard-card">
    <h3><i class="fas fa-share-alt"></i> Social Media Links</h3>
    <div class="form-grid">
        <div class="form-group">
            <label><i class="fab fa-facebook"></i> Facebook</label>
            <input type="url" id="socialFacebook" value="https://facebook.com/alhudha" class="form-control">
        </div>
        <div class="form-group">
            <label><i class="fab fa-twitter"></i> Twitter</label>
            <input type="url" id="socialTwitter" value="https://twitter.com/alhudha" class="form-control">
        </div>
        <div class="form-group">
            <label><i class="fab fa-instagram"></i> Instagram</label>
            <input type="url" id="socialInstagram" value="https://instagram.com/alhudha" class="form-control">
        </div>
        <div class="form-group">
            <label><i class="fab fa-whatsapp"></i> WhatsApp</label>
            <input type="url" id="socialWhatsapp" value="https://wa.me/919876543210" class="form-control">
        </div>
    </div>
</div>

<!-- SEO Settings -->
<div class="dashboard-card">
    <h3><i class="fas fa-search"></i> SEO Settings</h3>
    <div class="form-grid">
        <div class="form-group full-width">
            <label>Meta Title</label>
            <input type="text" id="metaTitle" value="Alhudha Haj Travel - Complete Haj & Umrah Management System" class="form-control">
        </div>
        <div class="form-group full-width">
            <label>Meta Description</label>
            <textarea id="metaDesc" rows="2" class="form-control">Complete Haj and Umrah travel management system with 33-field application form, admin panel, and document upload.</textarea>
        </div>
        <div class="form-group full-width">
            <label>Meta Keywords</label>
            <input type="text" id="metaKeywords" value="Haj packages, Umrah, Ramadhan, pilgrimage" class="form-control">
        </div>
    </div>
</div>

<!-- Save Button (Bottom) -->
<div style="text-align: right; margin-top: 30px;">
    <button class="action-btn btn-primary btn-large" onclick="saveFrontPage()">
        <i class="fas fa-save"></i> Publish Changes
    </button>
</div>

<!-- Preview Modal -->
<div id="previewModal" class="modal modal-large" style="display: none;">
    <div class="modal-header">
        <h3><i class="fas fa-eye"></i> Front Page Preview</h3>
        <button class="modal-close" onclick="closePreviewModal()">&times;</button>
    </div>
    <div id="previewContent" style="max-height: 70vh; overflow-y: auto; padding: 20px;"></div>
    <div class="modal-footer">
        <button class="action-btn btn-primary" onclick="closePreviewModal()">Close</button>
    </div>
</div>

<!-- Overlay -->
<div id="modalOverlay" class="modal-overlay" onclick="closePreviewModal()"></div>

<script>
    let features = [
        { icon: 'fas fa-calendar-alt', title: '25+ Years', desc: 'Experience in Haj & Umrah services' },
        { icon: 'fas fa-users', title: '5000+', desc: 'Happy Pilgrims Served' },
        { icon: 'fas fa-hotel', title: 'Premium', desc: 'Hotels near Haram' },
        { icon: 'fas fa-bus', title: 'VIP Transport', desc: 'Comfortable travel' }
    ];

    document.addEventListener('DOMContentLoaded', function() {
        loadFrontPage();
        loadPackagesForFeatured();
    });

    function loadFrontPage() {
        // Load current front page settings from API
        fetch('/api/frontpage/settings', { credentials: 'include' })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    applySettings(data.settings);
                } else {
                    loadDemoSettings();
                }
            })
            .catch(err => {
                console.error('Error loading front page:', err);
                loadDemoSettings();
            });
        
        renderFeatures();
    }

    function loadDemoSettings() {
        // Using default values already in HTML
        console.log('Using demo settings');
    }

    function applySettings(settings) {
        // Apply settings to form fields
        if (settings.hero) {
            document.getElementById('heroTitle').value = settings.hero.title || 'Your Journey to the Holy Land';
            document.getElementById('heroSubtitle').value = settings.hero.subtitle || '';
            document.getElementById('heroButtonText').value = settings.hero.button_text || 'View Packages';
            document.getElementById('heroButtonLink').value = settings.hero.button_link || '#packages';
        }
        
        if (settings.company) {
            document.getElementById('companyName').value = settings.company.name || 'Alhudha Haj Travel';
            document.getElementById('companyTagline').value = settings.company.tagline || '';
            document.getElementById('companyBadge').value = settings.company.badge || 'Est. 1998';
            document.getElementById('companyDescription').value = settings.company.description || '';
        }
        
        if (settings.features) {
            features = settings.features;
            renderFeatures();
        }
        
        if (settings.packages) {
            document.getElementById('packagesTitle').value = settings.packages.title || 'Our Haj & Umrah Packages';
            document.getElementById('packagesSubtitle').value = settings.packages.subtitle || '';
            document.getElementById('packagesStyle').value = settings.packages.style || 'grid';
            document.getElementById('packagesPerRow').value = settings.packages.per_row || '3';
        }
        
        if (settings.cta) {
            document.getElementById('ctaTitle').value = settings.cta.title || 'Ready to Start Your Journey?';
            document.getElementById('ctaDesc').value = settings.cta.description || '';
            document.getElementById('ctaLeftText').value = settings.cta.left_text || 'Traveler Login';
            document.getElementById('ctaLeftLink').value = settings.cta.left_link || 'traveler_login.html';
            document.getElementById('ctaRightText').value = settings.cta.right_text || 'Admin Panel';
            document.getElementById('ctaRightLink').value = settings.cta.right_link || 'admin.login.html';
        }
        
        if (settings.contact) {
            document.getElementById('contactPhone1').value = settings.contact.phone1 || '+91 98765 43210';
            document.getElementById('contactPhone2').value = settings.contact.phone2 || '+91 98765 43211';
            document.getElementById('contactEmail1').value = settings.contact.email1 || 'info@alhudha.com';
            document.getElementById('contactEmail2').value = settings.contact.email2 || 'support@alhudha.com';
            document.getElementById('contactAddress').value = settings.contact.address || '';
        }
        
        if (settings.social) {
            document.getElementById('socialFacebook').value = settings.social.facebook || '';
            document.getElementById('socialTwitter').value = settings.social.twitter || '';
            document.getElementById('socialInstagram').value = settings.social.instagram || '';
            document.getElementById('socialWhatsapp').value = settings.social.whatsapp || '';
        }
        
        if (settings.seo) {
            document.getElementById('metaTitle').value = settings.seo.title || '';
            document.getElementById('metaDesc').value = settings.seo.description || '';
            document.getElementById('metaKeywords').value = settings.seo.keywords || '';
        }
    }

    function renderFeatures() {
        const container = document.getElementById('featuresContainer');
        container.innerHTML = '';
        
        features.forEach((feature, index) => {
            const featureDiv = document.createElement('div');
            featureDiv.className = 'feature-item';
            featureDiv.style.cssText = 'display: grid; grid-template-columns: 100px 1fr 1fr auto; gap: 10px; margin-bottom: 10px; align-items: center; background: #f8f9fa; padding: 15px; border-radius: 8px;';
            featureDiv.innerHTML = `
                <select class="feature-icon" onchange="updateFeatureIcon(${index}, this.value)">
                    <option value="fas fa-calendar-alt" ${feature.icon === 'fas fa-calendar-alt' ? 'selected' : ''}>Calendar</option>
                    <option value="fas fa-users" ${feature.icon === 'fas fa-users' ? 'selected' : ''}>Users</option>
                    <option value="fas fa-hotel" ${feature.icon === 'fas fa-hotel' ? 'selected' : ''}>Hotel</option>
                    <option value="fas fa-bus" ${feature.icon === 'fas fa-bus' ? 'selected' : ''}>Bus</option>
                    <option value="fas fa-mosque" ${feature.icon === 'fas fa-mosque' ? 'selected' : ''}>Mosque</option>
                    <option value="fas fa-kaaba" ${feature.icon === 'fas fa-kaaba' ? 'selected' : ''}>Kaaba</option>
                </select>
                <input type="text" class="feature-title" value="${feature.title}" placeholder="Title" onchange="updateFeatureTitle(${index}, this.value)">
                <input type="text" class="feature-desc" value="${feature.desc}" placeholder="Description" onchange="updateFeatureDesc(${index}, this.value)">
                <button class="action-btn btn-danger" onclick="removeFeature(${index})" style="padding: 8px;">Ã—</button>
            `;
            container.appendChild(featureDiv);
        });
    }

    function updateFeatureIcon(index, value) {
        features[index].icon = value;
    }

    function updateFeatureTitle(index, value) {
        features[index].title = value;
    }

    function updateFeatureDesc(index, value) {
        features[index].desc = value;
    }

    function addFeature() {
        features.push({ icon: 'fas fa-star', title: 'New Feature', desc: 'Description here' });
        renderFeatures();
    }

    function removeFeature(index) {
        features.splice(index, 1);
        renderFeatures();
    }

    function loadPackagesForFeatured() {
        fetch('/api/batches/', { credentials: 'include' })
            .then(res => res.json())
            .then(data => {
                if (data.success && data.batches) {
                    const container = document.getElementById('featuredPackages');
                    container.innerHTML = '<p style="color: #7f8c8d; margin: 10px 0;">Select packages to feature on homepage:</p>';
                    
                    data.batches.forEach(batch => {
                        const div = document.createElement('div');
                        div.style.cssText = 'display: flex; align-items: center; gap: 10px; margin: 5px 0;';
                        div.innerHTML = `
                            <input type="checkbox" value="${batch.id}" id="pkg_${batch.id}" ${batch.featured ? 'checked' : ''}>
                            <label for="pkg_${batch.id}">${batch.batch_name}</label>
                        `;
                        container.appendChild(div);
                    });
                }
            })
            .catch(err => console.error('Error loading packages:', err));
    }

    function previewHeroImage(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('heroPreview');
                preview.src = e.target.result;
                preview.style.display = 'block';
                document.getElementById('heroImageText').textContent = input.files[0].name;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function previewFrontPage() {
        // Collect all settings
        const settings = collectSettings();
        
        // Generate preview HTML
        const preview = generatePreviewHTML(settings);
        
        document.getElementById('previewContent').innerHTML = preview;
        document.getElementById('previewModal').style.display = 'block';
        document.getElementById('modalOverlay').style.display = 'block';
    }

    function collectSettings() {
        return {
            hero: {
                title: document.getElementById('heroTitle').value,
                subtitle: document.getElementById('heroSubtitle').value,
                button_text: document.getElementById('heroButtonText').value,
                button_link: document.getElementById('heroButtonLink').value
            },
            company: {
                name: document.getElementById('companyName').value,
                tagline: document.getElementById('companyTagline').value,
                badge: document.getElementById('companyBadge').value,
                description: document.getElementById('companyDescription').value
            },
            features: features,
            packages: {
                title: document.getElementById('packagesTitle').value,
                subtitle: document.getElementById('packagesSubtitle').value,
                style: document.getElementById('packagesStyle').value,
                per_row: document.getElementById('packagesPerRow').value
            },
            cta: {
                title: document.getElementById('ctaTitle').value,
                description: document.getElementById('ctaDesc').value,
                left_text: document.getElementById('ctaLeftText').value,
                left_link: document.getElementById('ctaLeftLink').value,
                right_text: document.getElementById('ctaRightText').value,
                right_link: document.getElementById('ctaRightLink').value
            },
            contact: {
                phone1: document.getElementById('contactPhone1').value,
                phone2: document.getElementById('contactPhone2').value,
                email1: document.getElementById('contactEmail1').value,
                email2: document.getElementById('contactEmail2').value,
                address: document.getElementById('contactAddress').value
            },
            social: {
                facebook: document.getElementById('socialFacebook').value,
                twitter: document.getElementById('socialTwitter').value,
                instagram: document.getElementById('socialInstagram').value,
                whatsapp: document.getElementById('socialWhatsapp').value
            },
            seo: {
                title: document.getElementById('metaTitle').value,
                description: document.getElementById('metaDesc').value,
                keywords: document.getElementById('metaKeywords').value
            }
        };
    }

    function generatePreviewHTML(settings) {
        return `
            <div style="font-family: 'Segoe UI', sans-serif;">
                <!-- Navbar Preview -->
                <div style="background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; padding: 15px 30px; display: flex; justify-content: space-between;">
                    <div style="font-size: 1.5rem; font-weight: bold;">${settings.company.name}</div>
                    <div style="display: flex; gap: 20px;">
                        <span>Home</span>
                        <span>Packages</span>
                        <span>About</span>
                        <span>Contact</span>
                    </div>
                </div>
                
                <!-- Hero Preview -->
                <div style="background: linear-gradient(rgba(30,60,114,0.8), rgba(42,82,152,0.8)), url(''); color: white; padding: 80px 30px; text-align: center;">
                    <div style="background: #ffd700; color: #1e3c72; display: inline-block; padding: 5px 20px; border-radius: 50px; margin-bottom: 20px;">${settings.company.badge}</div>
                    <h1 style="font-size: 3rem;">${settings.hero.title}</h1>
                    <p style="font-size: 1.2rem;">${settings.hero.subtitle}</p>
                    <button style="background: #ffd700; color: #1e3c72; border: none; padding: 15px 40px; border-radius: 50px; margin-top: 20px;">${settings.hero.button_text}</button>
                </div>
                
                <!-- Features Preview -->
                <div style="padding: 60px 30px; background: white;">
                    <h2 style="text-align: center; color: #1e3c72;">Why Choose ${settings.company.name}?</h2>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-top: 40px;">
                        ${settings.features.map(f => `
                            <div style="text-align: center;">
                                <i class="${f.icon}" style="font-size: 3rem; color: #ffd700;"></i>
                                <h3>${f.title}</h3>
                                <p>${f.desc}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- CTA Preview -->
                <div style="background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; padding: 60px 30px; text-align: center;">
                    <h2>${settings.cta.title}</h2>
                    <p>${settings.cta.description}</p>
                    <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px;">
                        <a href="${settings.cta.left_link}" style="background: #ffd700; color: #1e3c72; padding: 15px 30px; border-radius: 50px; text-decoration: none;">${settings.cta.left_text}</a>
                        <a href="${settings.cta.right_link}" style="background: transparent; border: 2px solid white; color: white; padding: 15px 30px; border-radius: 50px; text-decoration: none;">${settings.cta.right_text}</a>
                    </div>
                </div>
                
                <!-- Footer Preview -->
                <div style="background: #1e3c72; color: white; padding: 40px 30px;">
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 30px;">
                        <div>
                            <h4>${settings.company.name}</h4>
                            <p>${settings.company.description}</p>
                        </div>
                        <div>
                            <h4>Contact</h4>
                            <p>${settings.contact.phone1}<br>${settings.contact.email1}</p>
                        </div>
                        <div>
                            <h4>Address</h4>
                            <p>${settings.contact.address}</p>
                        </div>
                        <div>
                            <h4>Follow Us</h4>
                            <div style="display: flex; gap: 10px;">
                                <i class="fab fa-facebook"></i>
                                <i class="fab fa-twitter"></i>
                                <i class="fab fa-instagram"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    async function saveFrontPage() {
        const settings = collectSettings();
        
        const btn = event.target;
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        btn.disabled = true;
        
        try {
            const response = await fetch('/api/frontpage/save', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify(settings)
            });
            
            if (response.status === 401) {
                showNotification('Session expired. Please login again', 'error');
                setTimeout(() => {
                    window.location.href = '/admin.login.html';
                }, 2000);
                return;
            }
            
            const data = await response.json();
            
            if (data.success) {
                showNotification('Front page updated successfully!', 'success');
            } else {
                showNotification('Error: ' + (data.error || 'Could not save'), 'error');
            }
        } catch (error) {
            console.error('Error saving front page:', error);
            showNotification('Error saving front page. Using demo mode.', 'warning');
            showDemoSave();
        } finally {
            btn.innerHTML = originalText;
            btn.disabled = false;
        }
    }

    function showDemoSave() {
        showNotification('Demo: Front page settings saved!', 'success');
    }

    function closePreviewModal() {
        document.getElementById('previewModal').style.display = 'none';
        document.getElementById('modalOverlay').style.display = 'none';
    }
</script>
