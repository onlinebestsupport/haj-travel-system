<div class="action-buttons">
    <button class="action-btn btn-primary" onclick="showGenerateReceiptModal()">
        <i class="fas fa-file-invoice"></i> Generate New Receipt
    </button>
    <button class="action-btn btn-success" onclick="showBulkReceiptModal()">
        <i class="fas fa-layer-group"></i> Bulk Receipt Generation
    </button>
    <button class="action-btn btn-info" onclick="loadReceipts()">
        <i class="fas fa-sync-alt"></i> Refresh
    </button>
    <button class="action-btn btn-warning" onclick="exportReceipts()">
        <i class="fas fa-download"></i> Export All
    </button>
</div>

<!-- Receipt Statistics -->
<div class="stats-grid">
    <div class="stat-card">
        <i class="fas fa-file-invoice"></i>
        <h3>Total Receipts</h3>
        <div class="stat-number" id="totalReceipts">234</div>
    </div>
    <div class="stat-card">
        <i class="fas fa-rupee-sign"></i>
        <h3>Total Amount</h3>
        <div class="stat-number" id="totalAmount">₹1,25,60,000</div>
    </div>
    <div class="stat-card">
        <i class="fas fa-users"></i>
        <h3>Travelers</h3>
        <div class="stat-number" id="receiptTravelers">156</div>
    </div>
    <div class="stat-card">
        <i class="fas fa-clock"></i>
        <h3>Last Receipt</h3>
        <div class="stat-number" id="lastReceipt">2 min ago</div>
    </div>
</div>

<!-- Main Receipt Tabs -->
<div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #ecf0f1; padding-bottom: 10px;">
    <button class="tab-btn active" onclick="showReceiptTab('all')">All Receipts</button>
    <button class="tab-btn" onclick="showReceiptTab('traveler')">By Traveler</button>
    <button class="tab-btn" onclick="showReceiptTab('batch')">By Batch</button>
    <button class="tab-btn" onclick="showReceiptTab('date')">By Date</button>
    <button class="tab-btn" onclick="showReceiptTab('pending')">Pending Receipts</button>
</div>

<!-- ============ ALL RECEIPTS TAB ============ -->
<div id="allTab" class="receipt-tab">
    <div class="dashboard-card">
        <h3><i class="fas fa-list"></i> All Payment Receipts</h3>
        
        <div style="margin-bottom: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
            <input type="text" id="searchReceipts" placeholder="Search by receipt no, traveler, passport..." class="form-control" style="width: 300px;">
            <select id="receiptTypeFilter" class="form-control" style="width: 150px;">
                <option value="all">All Types</option>
                <option value="booking">Booking</option>
                <option value="installment">Installment</option>
                <option value="full">Full Payment</option>
                <option value="refund">Refund</option>
            </select>
            <select id="receiptStatusFilter" class="form-control" style="width: 150px;">
                <option value="all">All Status</option>
                <option value="paid">Paid</option>
                <option value="pending">Pending</option>
                <option value="cancelled">Cancelled</option>
            </select>
            <input type="date" id="receiptDateFrom" class="form-control" style="width: 150px;" placeholder="From">
            <input type="date" id="receiptDateTo" class="form-control" style="width: 150px;" placeholder="To">
            <button class="action-btn btn-primary" onclick="filterReceipts()">Filter</button>
            <button class="action-btn btn-secondary" onclick="resetFilters()">Reset</button>
        </div>
        
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Receipt No</th>
                        <th>Date</th>
                        <th>Traveler</th>
                        <th>Passport</th>
                        <th>Batch/Package</th>
                        <th>Installment</th>
                        <th>Amount</th>
                        <th>Payment Method</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="receiptsTable">
                    <!-- Receipts will be loaded here -->
                </tbody>
            </table>
        </div>
        
        <div style="margin-top: 20px; display: flex; justify-content: space-between; align-items: center;">
            <div>
                Showing <span id="showingStart">1</span> to <span id="showingEnd">10</span> of <span id="totalRecords">234</span> receipts
            </div>
            <div style="display: flex; gap: 5px;">
                <button class="action-btn btn-secondary btn-small" onclick="prevPage()" disabled>Previous</button>
                <span id="pageInfo">Page 1 of 24</span>
                <button class="action-btn btn-secondary btn-small" onclick="nextPage()">Next</button>
            </div>
        </div>
    </div>
</div>

<!-- ============ BY TRAVELER TAB ============ -->
<div id="travelerTab" class="receipt-tab" style="display: none;">
    <div class="dashboard-card">
        <h3><i class="fas fa-user"></i> Traveler Payment Summary</h3>
        
        <div style="margin-bottom: 20px;">
            <label>Select Traveler</label>
            <select id="travelerSelect" class="form-control" style="width: 100%; max-width: 500px;" onchange="loadTravelerPayments()">
                <option value="">Loading travelers...</option>
            </select>
        </div>
        
        <div id="travelerPaymentDetails" style="display: none;">
            <!-- Traveler info card -->
            <div style="background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h4 style="color: white; margin: 0;"><i class="fas fa-user-circle"></i> <span id="travelerName"></span></h4>
                    <span class="status-badge" style="background: #ffd700; color: #1e3c72;" id="travelerStatus">Active</span>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <p style="opacity: 0.8; margin-bottom: 5px;">Passport</p>
                        <p style="font-weight: 600;" id="travelerPassport"></p>
                    </div>
                    <div>
                        <p style="opacity: 0.8; margin-bottom: 5px;">Mobile</p>
                        <p style="font-weight: 600;" id="travelerMobile"></p>
                    </div>
                    <div>
                        <p style="opacity: 0.8; margin-bottom: 5px;">Email</p>
                        <p style="font-weight: 600;" id="travelerEmail"></p>
                    </div>
                    <div>
                        <p style="opacity: 0.8; margin-bottom: 5px;">Batch</p>
                        <p style="font-weight: 600;" id="travelerBatch"></p>
                    </div>
                </div>
            </div>
            
            <!-- Payment Summary Cards -->
            <div class="stats-grid" style="grid-template-columns: repeat(4, 1fr); margin-bottom: 20px;">
                <div class="stat-card">
                    <i class="fas fa-rupee-sign" style="color: #27ae60;"></i>
                    <h3>Package Price</h3>
                    <div class="stat-number" id="packagePrice">₹0</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-check-circle" style="color: #27ae60;"></i>
                    <h3>Total Paid</h3>
                    <div class="stat-number" id="totalPaid">₹0</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-clock" style="color: #f39c12;"></i>
                    <h3>Balance Due</h3>
                    <div class="stat-number" id="balanceDue">₹0</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-percent" style="color: #3498db;"></i>
                    <h3>Paid %</h3>
                    <div class="stat-number" id="paidPercentage">0%</div>
                </div>
            </div>
            
            <!-- Payment History -->
            <h4 style="margin: 20px 0 10px;">Payment History</h4>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Receipt No</th>
                            <th>Date</th>
                            <th>Installment</th>
                            <th>Amount</th>
                            <th>Method</th>
                            <th>Transaction ID</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="travelerPaymentsTable">
                        <!-- Payments will be loaded here -->
                    </tbody>
                </table>
            </div>
            
            <!-- Payment Timeline -->
            <h4 style="margin: 20px 0 10px;">Payment Timeline</h4>
            <div id="paymentTimeline" style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                <!-- Timeline will be populated here -->
            </div>
            
            <!-- Action Buttons -->
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button class="action-btn btn-primary" onclick="generateTravelerReceipt()">
                    <i class="fas fa-file-pdf"></i> Generate Full Statement
                </button>
                <button class="action-btn btn-success" onclick="downloadTravelerExcel()">
                    <i class="fas fa-file-excel"></i> Download Excel
                </button>
                <button class="action-btn btn-info" onclick="printTravelerStatement()">
                    <i class="fas fa-print"></i> Print Statement
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ============ BY BATCH TAB ============ -->
<div id="batchTab" class="receipt-tab" style="display: none;">
    <div class="dashboard-card">
        <h3><i class="fas fa-layer-group"></i> Batch Payment Summary</h3>
        
        <div style="margin-bottom: 20px;">
            <label>Select Batch</label>
            <select id="batchSelect" class="form-control" style="width: 100%; max-width: 500px;" onchange="loadBatchPayments()">
                <option value="">Loading batches...</option>
            </select>
        </div>
        
        <div id="batchPaymentDetails" style="display: none;">
            <!-- Batch info card -->
            <div style="background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h4 style="color: white; margin: 0;"><i class="fas fa-layer-group"></i> <span id="batchName"></span></h4>
                    <span class="status-badge" style="background: #ffd700; color: #1e3c72;" id="batchStatus">Open</span>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <p style="opacity: 0.8; margin-bottom: 5px;">Departure</p>
                        <p style="font-weight: 600;" id="batchDeparture"></p>
                    </div>
                    <div>
                        <p style="opacity: 0.8; margin-bottom: 5px;">Return</p>
                        <p style="font-weight: 600;" id="batchReturn"></p>
                    </div>
                    <div>
                        <p style="opacity: 0.8; margin-bottom: 5px;">Total Travelers</p>
                        <p style="font-weight: 600;" id="batchTravelers">0</p>
                    </div>
                    <div>
                        <p style="opacity: 0.8; margin-bottom: 5px;">Package Price</p>
                        <p style="font-weight: 600;" id="batchPrice">₹0</p>
                    </div>
                </div>
            </div>
            
            <!-- Batch Payment Stats -->
            <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 20px;">
                <div class="stat-card">
                    <i class="fas fa-rupee-sign" style="color: #27ae60;"></i>
                    <h3>Total Collected</h3>
                    <div class="stat-number" id="batchTotalCollected">₹0</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-clock" style="color: #f39c12;"></i>
                    <h3>Pending Amount</h3>
                    <div class="stat-number" id="batchPending">₹0</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-percent" style="color: #3498db;"></i>
                    <h3>Collection %</h3>
                    <div class="stat-number" id="batchCollectionPercent">0%</div>
                </div>
            </div>
            
            <!-- Traveler Payment List for Batch -->
            <h4 style="margin: 20px 0 10px;">Traveler Payments</h4>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Traveler</th>
                            <th>Passport</th>
                            <th>Total Paid</th>
                            <th>Balance</th>
                            <th>Status</th>
                            <th>Last Payment</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="batchPaymentsTable">
                        <!-- Batch payments will be loaded here -->
                    </tbody>
                </table>
            </div>
            
            <!-- Export Options -->
            <div style="margin-top: 20px;">
                <button class="action-btn btn-primary" onclick="exportBatchExcel()">
                    <i class="fas fa-file-excel"></i> Export Batch Excel
                </button>
                <button class="action-btn btn-success" onclick="generateBatchPDF()">
                    <i class="fas fa-file-pdf"></i> Generate Batch PDF
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ============ BY DATE TAB ============ -->
<div id="dateTab" class="receipt-tab" style="display: none;">
    <div class="dashboard-card">
        <h3><i class="fas fa-calendar"></i> Date-wise Receipt Summary</h3>
        
        <div style="margin-bottom: 20px; display: flex; gap: 10px; align-items: flex-end;">
            <div style="flex: 1;">
                <label>From Date</label>
                <input type="date" id="dateFrom" class="form-control" value="<?php echo date('Y-m-01'); ?>">
            </div>
            <div style="flex: 1;">
                <label>To Date</label>
                <input type="date" id="dateTo" class="form-control" value="<?php echo date('Y-m-d'); ?>">
            </div>
            <button class="action-btn btn-primary" onclick="loadDateWiseReceipts()">
                <i class="fas fa-search"></i> Show
            </button>
            <button class="action-btn btn-success" onclick="exportDateWiseExcel()">
                <i class="fas fa-file-excel"></i> Export
            </button>
        </div>
        
        <!-- Date-wise Stats -->
        <div class="stats-grid" style="grid-template-columns: repeat(4, 1fr); margin-bottom: 20px;">
            <div class="stat-card">
                <i class="fas fa-file-invoice"></i>
                <h3>Receipts</h3>
                <div class="stat-number" id="dateReceiptCount">0</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-rupee-sign"></i>
                <h3>Total Amount</h3>
                <div class="stat-number" id="dateTotalAmount">₹0</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-users"></i>
                <h3>Travelers</h3>
                <div class="stat-number" id="dateTravelerCount">0</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-credit-card"></i>
                <h3>Avg per Receipt</h3>
                <div class="stat-number" id="dateAvgAmount">₹0</div>
            </div>
        </div>
        
        <!-- Daily Breakdown Chart -->
        <div style="height: 300px; margin-bottom: 30px;">
            <canvas id="dailyReceiptChart"></canvas>
        </div>
        
        <!-- Date-wise Receipts Table -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Receipts Count</th>
                        <th>Total Amount</th>
                        <th>Cash</th>
                        <th>Bank Transfer</th>
                        <th>UPI</th>
                        <th>Credit Card</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="dateReceiptsTable">
                    <!-- Date-wise receipts will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- ============ PENDING RECEIPTS TAB ============ -->
<div id="pendingTab" class="receipt-tab" style="display: none;">
    <div class="dashboard-card">
        <h3><i class="fas fa-clock"></i> Pending Receipts / Due Payments</h3>
        
        <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 20px;">
            <div class="stat-card">
                <i class="fas fa-users"></i>
                <h3>Travelers with Dues</h3>
                <div class="stat-number" id="dueTravelers">45</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-rupee-sign"></i>
                <h3>Total Due Amount</h3>
                <div class="stat-number" id="totalDue">₹24,50,000</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-exclamation-triangle" style="color: #e74c3c;"></i>
                <h3>Overdue (>30 days)</h3>
                <div class="stat-number" id="overdueAmount">₹8,75,000</div>
            </div>
        </div>
        
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Traveler</th>
                        <th>Passport</th>
                        <th>Batch</th>
                        <th>Package Price</th>
                        <th>Paid</th>
                        <th>Balance</th>
                        <th>Due Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="pendingReceiptsTable">
                    <!-- Pending receipts will be loaded here -->
                </tbody>
            </table>
        </div>
        
        <div style="margin-top: 20px;">
            <button class="action-btn btn-warning" onclick="sendReminders()">
                <i class="fas fa-bell"></i> Send Payment Reminders
            </button>
            <button class="action-btn btn-primary" onclick="exportDueList()">
                <i class="fas fa-download"></i> Export Due List
            </button>
        </div>
    </div>
</div>

<!-- ============ GENERATE RECEIPT MODAL ============ -->
<div id="generateReceiptModal" class="modal modal-large" style="display: none;">
    <div class="modal-header">
        <h3><i class="fas fa-file-invoice"></i> Generate Payment Receipt</h3>
        <button class="modal-close" onclick="closeGenerateModal()">&times;</button>
    </div>
    
    <div class="form-group">
        <label>Select Traveler *</label>
        <select id="receiptTraveler" class="form-control" onchange="loadTravelerForReceipt()">
            <option value="">Loading travelers...</option>
        </select>
    </div>
    
    <div id="receiptTravelerInfo" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
            <div><strong>Name:</strong> <span id="receiptTravelerName"></span></div>
            <div><strong>Passport:</strong> <span id="receiptTravelerPassport"></span></div>
            <div><strong>Mobile:</strong> <span id="receiptTravelerMobile"></span></div>
            <div><strong>Batch:</strong> <span id="receiptTravelerBatch"></span></div>
            <div><strong>Package Price:</strong> <span id="receiptPackagePrice"></span></div>
            <div><strong>Total Paid:</strong> <span id="receiptTotalPaid"></span></div>
            <div><strong>Balance:</strong> <span id="receiptBalance"></span></div>
        </div>
    </div>
    
    <form id="receiptForm">
        <div class="form-grid">
            <div class="form-group">
                <label>Receipt Type</label>
                <select id="receiptType" class="form-control" onchange="toggleReceiptFields()">
                    <option value="booking">Booking Amount Receipt</option>
                    <option value="installment">Installment Receipt</option>
                    <option value="full">Full Payment Receipt</option>
                    <option value="refund">Refund Receipt</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Installment (if applicable)</label>
                <select id="receiptInstallment" class="form-control">
                    <option value="">Select Installment</option>
                    <option value="1st Installment">1st Installment</option>
                    <option value="2nd Installment">2nd Installment</option>
                    <option value="3rd Installment">3rd Installment</option>
                    <option value="4th Installment">4th Installment</option>
                    <option value="Final Installment">Final Installment</option>
                </select>
            </div>
        </div>
        
        <div class="form-grid">
            <div class="form-group">
                <label>Amount (₹) *</label>
                <input type="number" id="receiptAmount" class="form-control" step="1" min="1" required oninput="updateReceiptTotals()">
            </div>
            
            <div class="form-group">
                <label>Payment Date *</label>
                <input type="date" id="receiptDate" class="form-control" value="<?php echo date('Y-m-d'); ?>" required>
            </div>
            
            <div class="form-group">
                <label>Payment Method *</label>
                <select id="receiptMethod" class="form-control" required>
                    <option value="">Select Method</option>
                    <option value="Cash">Cash</option>
                    <option value="Bank Transfer">Bank Transfer</option>
                    <option value="UPI">UPI</option>
                    <option value="Credit Card">Credit Card</option>
                    <option value="Debit Card">Debit Card</option>
                    <option value="Cheque">Cheque</option>
                    <option value="Demand Draft">Demand Draft</option>
                </select>
            </div>
        </div>
        
        <div class="form-grid">
            <div class="form-group">
                <label>Transaction ID / Reference</label>
                <input type="text" id="receiptTransaction" class="form-control" placeholder="UPI ID / Cheque No / Ref">
            </div>
            
            <div class="form-group">
                <label>Bank Name (if applicable)</label>
                <input type="text" id="receiptBank" class="form-control" placeholder="e.g., SBI, HDFC">
            </div>
            
            <div class="form-group">
                <label>Cheque/DD Date</label>
                <input type="date" id="receiptChequeDate" class="form-control">
            </div>
        </div>
        
        <div class="form-group">
            <label>Remarks / Notes</label>
            <textarea id="receiptRemarks" rows="2" class="form-control" placeholder="Any additional notes..."></textarea>
        </div>
        
        <!-- Receipt Preview -->
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 15px 0;">
            <h4 style="color: #3498db;">Receipt Preview</h4>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <p><strong>Receipt No:</strong> <span id="previewReceiptNo">RCP-2026-0001</span></p>
                    <p><strong>Date:</strong> <span id="previewDate"><?php echo date('d-m-Y'); ?></span></p>
                </div>
                <div style="text-align: right;">
                    <p><strong>Amount:</strong> <span style="font-size: 1.5rem; color: #27ae60;" id="previewAmount">₹0</span></p>
                </div>
            </div>
            <div style="border-top: 1px dashed #ddd; margin: 10px 0; padding-top: 10px;">
                <p id="previewInWords">Zero Rupees Only</p>
            </div>
        </div>
        
        <div class="modal-footer">
            <button type="submit" class="action-btn btn-primary">Generate Receipt</button>
            <button type="button" class="action-btn btn-success" onclick="previewPDF()">Preview PDF</button>
            <button type="button" class="action-btn btn-secondary" onclick="closeGenerateModal()">Cancel</button>
        </div>
    </form>
</div>

<!-- ============ BULK RECEIPT MODAL ============ -->
<div id="bulkReceiptModal" class="modal modal-large" style="display: none;">
    <div class="modal-header">
        <h3><i class="fas fa-layer-group"></i> Bulk Receipt Generation</h3>
        <button class="modal-close" onclick="closeBulkModal()">&times;</button>
    </div>
    
    <div class="form-group">
        <label>Select Batch</label>
        <select id="bulkBatchSelect" class="form-control" onchange="loadBatchTravelersForReceipt()">
            <option value="">Loading batches...</option>
        </select>
    </div>
    
    <div class="form-group">
        <label>Select Travelers</label>
        <div style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 5px;">
            <div id="bulkTravelersList">
                <!-- Travelers will be loaded here -->
            </div>
        </div>
    </div>
    
    <div class="form-group">
        <label><input type="checkbox" id="selectAllTravelers" onchange="toggleSelectAll()"> Select All</label>
    </div>
    
    <div class="form-grid">
        <div class="form-group">
            <label>Receipt Type</label>
            <select id="bulkReceiptType" class="form-control">
                <option value="booking">Booking Amount</option>
                <option value="installment">Installment</option>
                <option value="full">Full Payment</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>Amount per Traveler</label>
            <input type="number" id="bulkAmount" class="form-control" step="1" min="1">
        </div>
        
        <div class="form-group">
            <label>Payment Date</label>
            <input type="date" id="bulkDate" class="form-control" value="<?php echo date('Y-m-d'); ?>">
        </div>
        
        <div class="form-group">
            <label>Payment Method</label>
            <select id="bulkMethod" class="form-control">
                <option value="Cash">Cash</option>
                <option value="Bank Transfer">Bank Transfer</option>
                <option value="UPI">UPI</option>
                <option value="Credit Card">Credit Card</option>
            </select>
        </div>
    </div>
    
    <div class="modal-footer">
        <button class="action-btn btn-primary" onclick="generateBulkReceipts()">Generate Receipts</button>
        <button class="action-btn btn-secondary" onclick="closeBulkModal()">Cancel</button>
    </div>
</div>

<!-- ============ RECEIPT VIEW MODAL ============ -->
<div id="receiptViewModal" class="modal modal-large" style="display: none;">
    <div class="modal-header">
        <h3><i class="fas fa-file-invoice"></i> Payment Receipt</h3>
        <button class="modal-close" onclick="closeViewModal()">&times;</button>
    </div>
    
    <div id="receiptContent" style="padding: 20px; background: white;">
        <!-- Receipt content will be loaded here -->
    </div>
    
    <div class="modal-footer">
        <button class="action-btn btn-primary" onclick="downloadPDF()"><i class="fas fa-file-pdf"></i> Download PDF</button>
        <button class="action-btn btn-success" onclick="downloadExcel()"><i class="fas fa-file-excel"></i> Download Excel</button>
        <button class="action-btn btn-info" onclick="printReceipt()"><i class="fas fa-print"></i> Print</button>
        <button class="action-btn btn-secondary" onclick="emailReceipt()"><i class="fas fa-envelope"></i> Email</button>
        <button class="action-btn btn-secondary" onclick="closeViewModal()">Close</button>
    </div>
</div>

<!-- Overlay -->
<div id="modalOverlay" class="modal-overlay" onclick="closeAllModals()"></div>

<!-- Include Chart.js for graphs -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/number-to-words@1.2.4/index.min.js"></script>

<style>
    .receipt-tab {
        animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .modal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        z-index: 2000;
        max-width: 90%;
        width: 900px;
        max-height: 90vh;
        overflow-y: auto;
    }
    
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 1999;
    }
    
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #ecf0f1;
    }
    
    .modal-close {
        background: none;
        border: none;
        font-size: 1.8rem;
        cursor: pointer;
        color: #7f8c8d;
    }
    
    .modal-close:hover {
        color: #e74c3c;
    }
    
    .modal-footer {
        margin-top: 20px;
        padding-top: 10px;
        border-top: 1px solid #ecf0f1;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .btn-small {
        padding: 8px 15px;
        font-size: 0.9rem;
    }
    
    .timeline-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 15px;
        position: relative;
    }
    
    .timeline-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #3498db;
        margin-right: 15px;
        margin-top: 5px;
    }
    
    .timeline-content {
        flex: 1;
        background: white;
        padding: 12px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
</style>

<script>
    let dailyChart = null;
    let currentPage = 1;
    const itemsPerPage = 10;

    document.addEventListener('DOMContentLoaded', function() {
        loadReceipts();
        loadTravelersForDropdown();
        loadBatchesForDropdown();
        loadPendingReceipts();
        showReceiptTab('all');
    });

    // ============ TAB NAVIGATION ============
    function showReceiptTab(tab) {
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        document.querySelectorAll('.receipt-tab').forEach(t => t.style.display = 'none');
        document.getElementById(tab + 'Tab').style.display = 'block';
        
        if (tab === 'date') {
            initDateChart();
            loadDateWiseReceipts();
        }
    }

    // ============ LOAD RECEIPTS ============
    function loadReceipts() {
        const receipts = [
            { id: 1, receipt_no: 'RCP-2026-0001', date: '2026-02-18', traveler: 'Ahmed Khan', passport: 'A1234567', batch: 'Haj Platinum 2026', installment: 'Booking', amount: 85000, method: 'Bank Transfer', status: 'paid' },
            { id: 2, receipt_no: 'RCP-2026-0002', date: '2026-02-18', traveler: 'Fatima Begum', passport: 'B7654321', batch: 'Haj Gold 2026', installment: '1st', amount: 110000, method: 'UPI', status: 'paid' },
            { id: 3, receipt_no: 'RCP-2026-0003', date: '2026-02-17', traveler: 'Mohammed Rafi', passport: 'C9876543', batch: 'Umrah Ramadhan', installment: 'Full', amount: 125000, method: 'Cash', status: 'paid' },
            { id: 4, receipt_no: 'RCP-2026-0004', date: '2026-02-17', traveler: 'Aisha Begum', passport: 'D4567890', batch: 'Umrah Winter', installment: 'Booking', amount: 19000, method: 'Credit Card', status: 'paid' },
            { id: 5, receipt_no: 'RCP-2026-0005', date: '2026-02-16', traveler: 'Omar Hassan', passport: 'E1122334', batch: 'Haj Platinum', installment: '2nd', amount: 170000, method: 'Bank Transfer', status: 'paid' },
        ];
        
        let html = '';
        receipts.forEach(r => {
            html += `<tr>
                <td><strong>${r.receipt_no}</strong></td>
                <td>${r.date}</td>
                <td>${r.traveler}</td>
                <td>${r.passport}</td>
                <td>${r.batch}</td>
                <td>${r.installment}</td>
                <td>₹${r.amount.toLocaleString()}</td>
                <td>${r.method}</td>
                <td><span class="status-badge status-active">${r.status}</span></td>
                <td>
                    <button class="icon-btn" onclick="viewReceipt(${r.id})" title="View"><i class="fas fa-eye"></i></button>
                    <button class="icon-btn" onclick="downloadReceipt(${r.id})" title="Download"><i class="fas fa-download"></i></button>
                    <button class="icon-btn" onclick="printReceipt(${r.id})" title="Print"><i class="fas fa-print"></i></button>
                    <button class="icon-btn" onclick="emailReceipt(${r.id})" title="Email"><i class="fas fa-envelope"></i></button>
                </td>
            </tr>`;
        });
        document.getElementById('receiptsTable').innerHTML = html;
        
        document.getElementById('totalRecords').textContent = '234';
        updatePagination();
    }

    // ============ TRAVELER DROPDOWNS ============
    function loadTravelersForDropdown() {
        const travelers = [
            { id: 1, name: 'Ahmed Khan', passport: 'A1234567' },
            { id: 2, name: 'Fatima Begum', passport: 'B7654321' },
            { id: 3, name: 'Mohammed Rafi', passport: 'C9876543' },
            { id: 4, name: 'Aisha Begum', passport: 'D4567890' },
            { id: 5, name: 'Omar Hassan', passport: 'E1122334' },
        ];
        
        let options = '<option value="">Select Traveler</option>';
        travelers.forEach(t => {
            options += `<option value="${t.id}">${t.name} (${t.passport})</option>`;
        });
        
        document.getElementById('receiptTraveler').innerHTML = options;
        document.getElementById('travelerSelect').innerHTML = '<option value="">Select Traveler</option>' + options;
    }

    function loadBatchesForDropdown() {
        const batches = [
            { id: 1, name: 'Haj Platinum 2026' },
            { id: 2, name: 'Haj Gold 2026' },
            { id: 3, name: 'Haj Silver 2026' },
            { id: 4, name: 'Umrah Ramadhan Special' },
            { id: 5, name: 'Umrah Winter' },
        ];
        
        let options = '<option value="">Select Batch</option>';
        batches.forEach(b => {
            options += `<option value="${b.id}">${b.name}</option>`;
        });
        
        document.getElementById('batchSelect').innerHTML = options;
        document.getElementById('bulkBatchSelect').innerHTML = options;
    }

    // ============ TRAVELER PAYMENTS ============
    function loadTravelerPayments() {
        const travelerId = document.getElementById('travelerSelect').value;
        if (!travelerId) {
            document.getElementById('travelerPaymentDetails').style.display = 'none';
            return;
        }
        
        document.getElementById('travelerPaymentDetails').style.display = 'block';
        
        // Demo data
        document.getElementById('travelerName').textContent = 'Ahmed Khan';
        document.getElementById('travelerPassport').textContent = 'A1234567';
        document.getElementById('travelerMobile').textContent = '+91 98765 43210';
        document.getElementById('travelerEmail').textContent = 'ahmed@email.com';
        document.getElementById('travelerBatch').textContent = 'Haj Platinum 2026';
        document.getElementById('travelerStatus').textContent = 'Active';
        
        const packagePrice = 850000;
        const totalPaid = 255000;
        const balance = packagePrice - totalPaid;
        const percentage = (totalPaid / packagePrice * 100).toFixed(1);
        
        document.getElementById('packagePrice').innerHTML = `₹${packagePrice.toLocaleString()}`;
        document.getElementById('totalPaid').innerHTML = `₹${totalPaid.toLocaleString()}`;
        document.getElementById('balanceDue').innerHTML = `₹${balance.toLocaleString()}`;
        document.getElementById('paidPercentage').textContent = `${percentage}%`;
        
        // Payment history
        const payments = [
            { receipt: 'RCP-2026-0001', date: '2026-01-15', installment: 'Booking Amount', amount: 85000, method: 'Bank Transfer', transaction: 'TXN123456', status: 'paid' },
            { receipt: 'RCP-2026-0010', date: '2026-02-10', installment: '1st Installment', amount: 170000, method: 'UPI', transaction: 'UPI789012', status: 'paid' },
        ];
        
        let html = '';
        payments.forEach(p => {
            html += `<tr>
                <td><strong>${p.receipt}</strong></td>
                <td>${p.date}</td>
                <td>${p.installment}</td>
                <td>₹${p.amount.toLocaleString()}</td>
                <td>${p.method}</td>
                <td>${p.transaction}</td>
                <td><span class="status-badge status-active">${p.status}</span></td>
                <td>
                    <button class="icon-btn" onclick="viewReceipt('${p.receipt}')"><i class="fas fa-eye"></i></button>
                </td>
            </tr>`;
        });
        document.getElementById('travelerPaymentsTable').innerHTML = html;
        
        // Payment timeline
        let timeline = '';
        payments.forEach((p, index) => {
            timeline += `
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>${p.installment}</strong>
                            <span style="color: #27ae60;">₹${p.amount.toLocaleString()}</span>
                        </div>
                        <div style="display: flex; gap: 20px; margin-top: 5px; color: #7f8c8d;">
                            <span><i class="fas fa-calendar"></i> ${p.date}</span>
                            <span><i class="fas fa-credit-card"></i> ${p.method}</span>
                        </div>
                    </div>
                </div>
            `;
        });
        // Add pending payment
        timeline += `
            <div class="timeline-item">
                <div class="timeline-dot" style="background: #f39c12;"></div>
                <div class="timeline-content" style="background: #fff3cd;">
                    <div style="display: flex; justify-content: space-between;">
                        <strong>2nd Installment (Due)</strong>
                        <span style="color: #f39c12;">₹255,000</span>
                    </div>
                    <div style="margin-top: 5px; color: #856404;">
                        <span><i class="fas fa-calendar"></i> Due: 2026-03-15</span>
                    </div>
                </div>
            </div>
        `;
        document.getElementById('paymentTimeline').innerHTML = timeline;
    }

    // ============ BATCH PAYMENTS ============
    function loadBatchPayments() {
        const batchId = document.getElementById('batchSelect').value;
        if (!batchId) {
            document.getElementById('batchPaymentDetails').style.display = 'none';
            return;
        }
        
        document.getElementById('batchPaymentDetails').style.display = 'block';
        
        document.getElementById('batchName').textContent = 'Haj Platinum 2026';
        document.getElementById('batchStatus').textContent = 'Open';
        document.getElementById('batchDeparture').textContent = '2026-06-14';
        document.getElementById('batchReturn').textContent = '2026-07-31';
        document.getElementById('batchTravelers').textContent = '45';
        document.getElementById('batchPrice').innerHTML = '₹8,50,000';
        document.getElementById('batchTotalCollected').innerHTML = '₹2,55,00,000';
        document.getElementById('batchPending').innerHTML = '₹1,27,50,000';
        document.getElementById('batchCollectionPercent').textContent = '66.7%';
        
        const travelers = [
            { name: 'Ahmed Khan', passport: 'A1234567', paid: 255000, balance: 595000, status: 'Partial', last: '2026-02-10' },
            { name: 'Fatima Begum', passport: 'B7654321', paid: 550000, balance: 0, status: 'Paid', last: '2026-02-05' },
            { name: 'Mohammed Rafi', passport: 'C9876543', paid: 0, balance: 850000, status: 'Pending', last: 'Never' },
        ];
        
        let html = '';
        travelers.forEach(t => {
            const statusClass = t.status === 'Paid' ? 'status-active' : (t.status === 'Partial' ? 'status-pending' : 'status-inactive');
            html += `<tr>
                <td><strong>${t.name}</strong></td>
                <td>${t.passport}</td>
                <td>₹${t.paid.toLocaleString()}</td>
                <td>₹${t.balance.toLocaleString()}</td>
                <td><span class="status-badge ${statusClass}">${t.status}</span></td>
                <td>${t.last}</td>
                <td>
                    <button class="icon-btn" onclick="viewTravelerReceipts('${t.passport}')"><i class="fas fa-eye"></i></button>
                </td>
            </tr>`;
        });
        document.getElementById('batchPaymentsTable').innerHTML = html;
    }

    // ============ DATE WISE RECEIPTS ============
    function initDateChart() {
        const ctx = document.getElementById('dailyReceiptChart').getContext('2d');
        if (dailyChart) dailyChart.destroy();
        
        dailyChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Daily Collection (₹)',
                    data: [125000, 234000, 198000, 312000, 276000, 189000, 98000],
                    borderColor: '#27ae60',
                    backgroundColor: 'rgba(39, 174, 96, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                }
            }
        });
    }

    function loadDateWiseReceipts() {
        document.getElementById('dateReceiptCount').textContent = '45';
        document.getElementById('dateTotalAmount').innerHTML = '₹12,45,000';
        document.getElementById('dateTravelerCount').textContent = '38';
        document.getElementById('dateAvgAmount').innerHTML = '₹27,667';
        
        const daily = [
            { date: '2026-02-18', count: 12, total: 325000, cash: 85000, bank: 150000, upi: 65000, card: 25000 },
            { date: '2026-02-17', count: 15, total: 412000, cash: 120000, bank: 180000, upi: 72000, card: 40000 },
            { date: '2026-02-16', count: 10, total: 278000, cash: 65000, bank: 130000, upi: 53000, card: 30000 },
        ];
        
        let html = '';
        daily.forEach(d => {
            html += `<tr>
                <td><strong>${d.date}</strong></td>
                <td>${d.count}</td>
                <td>₹${d.total.toLocaleString()}</td>
                <td>₹${d.cash.toLocaleString()}</td>
                <td>₹${d.bank.toLocaleString()}</td>
                <td>₹${d.upi.toLocaleString()}</td>
                <td>₹${d.card.toLocaleString()}</td>
                <td>
                    <button class="icon-btn" onclick="viewDateReceipts('${d.date}')"><i class="fas fa-eye"></i></button>
                </td>
            </tr>`;
        });
        document.getElementById('dateReceiptsTable').innerHTML = html;
    }

    // ============ PENDING RECEIPTS ============
    function loadPendingReceipts() {
        const pending = [
            { traveler: 'Ahmed Khan', passport: 'A1234567', batch: 'Haj Platinum', price: 850000, paid: 255000, balance: 595000, due: '2026-03-15', status: 'partial' },
            { traveler: 'Mohammed Rafi', passport: 'C9876543', batch: 'Umrah Ramadhan', price: 125000, paid: 0, balance: 125000, due: '2026-02-28', status: 'pending' },
            { traveler: 'Omar Hassan', passport: 'E1122334', batch: 'Haj Platinum', price: 850000, paid: 425000, balance: 425000, due: '2026-02-01', status: 'overdue' },
        ];
        
        let html = '';
        pending.forEach(p => {
            const statusClass = p.status === 'paid' ? 'status-active' : (p.status === 'partial' ? 'status-pending' : (p.status === 'overdue' ? 'status-inactive' : 'status-pending'));
            html += `<tr>
                <td><strong>${p.traveler}</strong></td>
                <td>${p.passport}</td>
                <td>${p.batch}</td>
                <td>₹${p.price.toLocaleString()}</td>
                <td>₹${p.paid.toLocaleString()}</td>
                <td>₹${p.balance.toLocaleString()}</td>
                <td>${p.due}</td>
                <td><span class="status-badge ${statusClass}">${p.status}</span></td>
                <td>
                    <button class="icon-btn" onclick="sendReminder('${p.passport}')"><i class="fas fa-bell"></i></button>
                    <button class="icon-btn" onclick="generateReceipt('${p.passport}')"><i class="fas fa-file-invoice"></i></button>
                </td>
            </tr>`;
        });
        document.getElementById('pendingReceiptsTable').innerHTML = html;
    }

    // ============ GENERATE RECEIPT ============
    function showGenerateReceiptModal() {
        document.getElementById('generateReceiptModal').style.display = 'block';
        document.getElementById('modalOverlay').style.display = 'block';
        document.getElementById('receiptTravelerInfo').style.display = 'none';
    }

    function closeGenerateModal() {
        document.getElementById('generateReceiptModal').style.display = 'none';
        document.getElementById('modalOverlay').style.display = 'none';
        document.getElementById('receiptForm').reset();
    }

    function loadTravelerForReceipt() {
        const travelerId = document.getElementById('receiptTraveler').value;
        if (!travelerId) {
            document.getElementById('receiptTravelerInfo').style.display = 'none';
            return;
        }
        
        document.getElementById('receiptTravelerInfo').style.display = 'block';
        document.getElementById('receiptTravelerName').textContent = 'Ahmed Khan';
        document.getElementById('receiptTravelerPassport').textContent = 'A1234567';
        document.getElementById('receiptTravelerMobile').textContent = '+91 98765 43210';
        document.getElementById('receiptTravelerBatch').textContent = 'Haj Platinum 2026';
        document.getElementById('receiptPackagePrice').innerHTML = '₹8,50,000';
        document.getElementById('receiptTotalPaid').innerHTML = '₹2,55,000';
        document.getElementById('receiptBalance').innerHTML = '₹5,95,000';
    }

    function toggleReceiptFields() {
        const type = document.getElementById('receiptType').value;
        const installmentField = document.getElementById('receiptInstallment');
        installmentField.disabled = type !== 'installment';
    }

    function updateReceiptTotals() {
        const amount = parseFloat(document.getElementById('receiptAmount').value) || 0;
        document.getElementById('previewAmount').innerHTML = `₹${amount.toLocaleString()}`;
        document.getElementById('previewInWords').textContent = numberToWords(amount) + ' Rupees Only';
        
        const today = new Date();
        const dd = String(today.getDate()).padStart(2, '0');
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const yyyy = today.getFullYear();
        document.getElementById('previewDate').textContent = `${dd}-${mm}-${yyyy}`;
        
        const receiptNo = 'RCP-' + yyyy + '-' + String(Math.floor(Math.random() * 10000)).padStart(4, '0');
        document.getElementById('previewReceiptNo').textContent = receiptNo;
    }

    function numberToWords(num) {
        if (typeof numberToWords !== 'undefined' && numberToWords.toWords) {
            return numberToWords.toWords(num);
        }
        
        // Simple fallback
        return num.toString();
    }

    document.getElementById('receiptForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const traveler = document.getElementById('receiptTraveler').value;
        if (!traveler) {
            alert('Please select a traveler');
            return;
        }
        
        showNotification('Receipt generated successfully!', 'success');
        closeGenerateModal();
        loadReceipts();
    });

    // ============ BULK RECEIPTS ============
    function showBulkReceiptModal() {
        document.getElementById('bulkReceiptModal').style.display = 'block';
        document.getElementById('modalOverlay').style.display = 'block';
        loadBatchTravelersForReceipt();
    }

    function closeBulkModal() {
        document.getElementById('bulkReceiptModal').style.display = 'none';
        document.getElementById('modalOverlay').style.display = 'none';
    }

    function loadBatchTravelersForReceipt() {
        const travelers = [
            { id: 1, name: 'Ahmed Khan', passport: 'A1234567' },
            { id: 2, name: 'Fatima Begum', passport: 'B7654321' },
            { id: 3, name: 'Mohammed Rafi', passport: 'C9876543' },
        ];
        
        let html = '';
        travelers.forEach(t => {
            html += `<div style="margin: 5px 0;">
                <label>
                    <input type="checkbox" class="traveler-checkbox" value="${t.id}">
                    ${t.name} (${t.passport})
                </label>
            </div>`;
        });
        document.getElementById('bulkTravelersList').innerHTML = html;
    }

    function toggleSelectAll() {
        const selectAll = document.getElementById('selectAllTravelers').checked;
        document.querySelectorAll('.traveler-checkbox').forEach(cb => {
            cb.checked = selectAll;
        });
    }

    function generateBulkReceipts() {
        const selected = [];
        document.querySelectorAll('.traveler-checkbox:checked').forEach(cb => {
            selected.push(cb.value);
        });
        
        if (selected.length === 0) {
            alert('Please select at least one traveler');
            return;
        }
        
        showNotification(`Generated ${selected.length} receipts successfully!`, 'success');
        closeBulkModal();
        loadReceipts();
    }

    // ============ RECEIPT VIEW ============
    function viewReceipt(id) {
        const receipt = {
            no: 'RCP-2026-0001',
            date: '2026-02-18',
            traveler: {
                name: 'Ahmed Khan',
                passport: 'A1234567',
                mobile: '+91 98765 43210',
                email: 'ahmed@email.com'
            },
            batch: 'Haj Platinum 2026',
            installment: 'Booking Amount',
            amount: 85000,
            in_words: 'Eighty Five Thousand Rupees Only',
            method: 'Bank Transfer',
            transaction: 'TXN123456',
            bank: 'SBI',
            remarks: 'Booking amount received'
        };
        
        const html = `
            <div style="font-family: 'Courier New', monospace; padding: 20px;">
                <!-- Company Header -->
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 style="color: #1e3c72; margin-bottom: 5px;">Alhudha Haj Travel</h2>
                    <p>123, Haj House, Mumbai - 400001</p>
                    <p>GSTIN: 27AABCU9603R1ZM | PAN: AABCU9603R</p>
                    <p>Tel: +91 98765 43210 | Email: accounts@alhudha.com</p>
                </div>
                
                <!-- Receipt Title -->
                <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
                    <div>
                        <h3 style="color: #3498db;">PAYMENT RECEIPT</h3>
                        <p><strong>Receipt No:</strong> ${receipt.no}</p>
                        <p><strong>Date:</strong> ${receipt.date}</p>
                    </div>
                    <div style="text-align: right;">
                        <p><strong>Place of Supply:</strong> Mumbai</p>
                        <p><strong>Reverse Charge:</strong> No</p>
                    </div>
                </div>
                
                <!-- Traveler Details -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h4 style="color: #3498db; margin-bottom: 10px;">Received from</h4>
                    <p><strong>${receipt.traveler.name}</strong></p>
                    <p>Passport: ${receipt.traveler.passport} | Mobile: ${receipt.traveler.mobile}</p>
                    <p>Email: ${receipt.traveler.email}</p>
                </div>
                
                <!-- Payment Details -->
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                    <tr style="background: #1e3c72; color: white;">
                        <th style="padding: 10px; text-align: left;">Description</th>
                        <th style="padding: 10px; text-align: right;">Amount</th>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border-bottom: 1px solid #ddd;">
                            ${receipt.batch} - ${receipt.installment}
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid #ddd; text-align: right;">
                            ₹${receipt.amount.toLocaleString()}
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; text-align: right;"><strong>Total</strong></td>
                        <td style="padding: 10px; text-align: right; font-size: 1.2rem; color: #27ae60;">
                            <strong>₹${receipt.amount.toLocaleString()}</strong>
                        </td>
                    </tr>
                </table>
                
                <!-- Amount in Words -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <p><strong>Amount in words:</strong> ${receipt.in_words}</p>
                </div>
                
                <!-- Payment Method -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                    <div>
                        <p style="color: #7f8c8d; margin-bottom: 5px;">Payment Method</p>
                        <p><strong>${receipt.method}</strong></p>
                    </div>
                    <div>
                        <p style="color: #7f8c8d; margin-bottom: 5px;">Transaction ID</p>
                        <p><strong>${receipt.transaction}</strong></p>
                    </div>
                    <div>
                        <p style="color: #7f8c8d; margin-bottom: 5px;">Bank</p>
                        <p><strong>${receipt.bank}</strong></p>
                    </div>
                </div>
                
                <!-- Remarks -->
                ${receipt.remarks ? `
                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <p><strong>Remarks:</strong> ${receipt.remarks}</p>
                </div>
                ` : ''}
                
                <!-- Footer -->
                <div style="margin-top: 40px; padding-top: 20px; border-top: 2px dashed #ddd;">
                    <p style="text-align: center;">This is a computer generated receipt - valid without signature</p>
                    <p style="text-align: center; margin-top: 10px;">Thank you for choosing Alhudha Haj Travel</p>
                </div>
            </div>
        `;
        
        document.getElementById('receiptContent').innerHTML = html;
        document.getElementById('receiptViewModal').style.display = 'block';
        document.getElementById('modalOverlay').style.display = 'block';
    }

    function closeViewModal() {
        document.getElementById('receiptViewModal').style.display = 'none';
        document.getElementById('modalOverlay').style.display = 'none';
    }

    // ============ DOWNLOAD / PRINT FUNCTIONS ============
    function downloadPDF() {
        showNotification('PDF download started...', 'info');
        setTimeout(() => {
            showNotification('PDF downloaded successfully!', 'success');
        }, 1500);
    }

    function downloadExcel() {
        showNotification('Excel download started...', 'info');
        setTimeout(() => {
            showNotification('Excel downloaded successfully!', 'success');
        }, 1500);
    }

    function printReceipt() {
        const content = document.getElementById('receiptContent').innerHTML;
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <html>
            <head>
                <title>Payment Receipt</title>
                <style>
                    body { font-family: Arial; padding: 30px; }
                    table { width: 100%; border-collapse: collapse; }
                    th { background: #1e3c72; color: white; padding: 10px; }
                    td { padding: 10px; border-bottom: 1px solid #ddd; }
                </style>
            </head>
            <body>
                ${content}
            </body>
            </html>
        `);
        printWindow.document.close();
        printWindow.print();
    }

    function emailReceipt() {
        showNotification('Receipt sent via email!', 'success');
    }

    // ============ EXPORT FUNCTIONS ============
    function exportReceipts() {
        showNotification('Exporting all receipts...', 'info');
        setTimeout(() => {
            showNotification('Receipts exported successfully!', 'success');
        }, 1500);
    }

    function exportBatchExcel() {
        showNotification('Batch data exported to Excel', 'success');
    }

    function generateBatchPDF() {
        showNotification('Generating batch PDF...', 'info');
    }

    function exportDateWiseExcel() {
        showNotification('Date-wise data exported to Excel', 'success');
    }

    function exportDueList() {
        showNotification('Due list exported to Excel', 'success');
    }

    function downloadTravelerExcel() {
        showNotification('Traveler statement exported to Excel', 'success');
    }

    function generateTravelerReceipt() {
        showNotification('Generating full statement...', 'info');
    }

    function printTravelerStatement() {
        showNotification('Preparing statement for print...', 'info');
    }

    // ============ REMINDERS ============
    function sendReminders() {
        showNotification('Payment reminders sent to 45 travelers!', 'success');
    }

    function sendReminder(passport) {
        showNotification(`Reminder sent to ${passport}`, 'success');
    }

    // ============ FILTER FUNCTIONS ============
    function filterReceipts() {
        showNotification('Filtering receipts...', 'info');
    }

    function resetFilters() {
        document.getElementById('searchReceipts').value = '';
        document.getElementById('receiptTypeFilter').value = 'all';
        document.getElementById('receiptStatusFilter').value = 'all';
        document.getElementById('receiptDateFrom').value = '';
        document.getElementById('receiptDateTo').value = '';
        showNotification('Filters reset', 'info');
    }

    function viewDateReceipts(date) {
        showNotification(`Viewing receipts for ${date}`, 'info');
    }

    function viewTravelerReceipts(passport) {
        showNotification(`Viewing receipts for ${passport}`, 'info');
    }

    function generateReceipt(passport) {
        showGenerateReceiptModal();
    }

    // ============ PAGINATION ============
    function updatePagination() {
        document.getElementById('showingStart').textContent = ((currentPage - 1) * itemsPerPage) + 1;
        document.getElementById('showingEnd').textContent = Math.min(currentPage * itemsPerPage, 234);
        document.getElementById('pageInfo').textContent = `Page ${currentPage} of 24`;
        
        document.querySelectorAll('.pagination-btn').forEach(btn => {
            if (btn.onclick.toString().includes('prevPage')) {
                btn.disabled = currentPage === 1;
            } else if (btn.onclick.toString().includes('nextPage')) {
                btn.disabled = currentPage === 24;
            }
        });
    }

    function prevPage() {
        if (currentPage > 1) {
            currentPage--;
            updatePagination();
        }
    }

    function nextPage() {
        if (currentPage < 24) {
            currentPage++;
            updatePagination();
        }
    }

    // ============ UTILITY ============
    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i> ${message}`;
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 5px;
            color: white;
            background: ${type === 'success' ? '#27ae60' : '#3498db'};
            z-index: 9999;
            animation: slideIn 0.3s ease;
        `;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }

    function closeAllModals() {
        document.getElementById('generateReceiptModal').style.display = 'none';
        document.getElementById('bulkReceiptModal').style.display = 'none';
        document.getElementById('receiptViewModal').style.display = 'none';
        document.getElementById('modalOverlay').style.display = 'none';
    }
</script>
